<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script
            src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=l7xx71377ca4d61b42018b3da0ede8c234fb"></script>
    <script type="text/javascript" th:inline="javascript">
        var map_count = 0;
        var page_lat = [[${page_lat}]];
        var page_lng = [[${page_lng}]];
        var map;
        var searchMarkerArr = [];
        var p_markerArr = [];
        var drawInfoArr = [];
        var resultdrawArr = [];
        var labelArr = [];
        var latLonArr = [];
        var nameArr = [];
        var searchMarkerArr2 = [];
        var labelArr2 = [];
        var latLonArr2 = [];
        var nameArr2 = [];
        s_marker = new Tmapv2.Marker({
            icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
            position: null, //Marker의 중심좌표 설정.
            draggable: true,
            map: null //Marker가 표시될 Map 설정.
        });
        e_marker = new Tmapv2.Marker({
            icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
            position: null, //Marker의 중심좌표 설정.
            draggable: true,
            map: null //Marker가 표시될 Map 설정.
        });

        // 화면 크기가 변경될때마다 함수 호출
        $(window).resize(function () {
            if (map_count == 0) {
                var width_size = window.outerWidth;
                // 화면의 height값을 가져오기
                var height_size = window.outerHeight;
                var mapResize = document.getElementById('map_div');//map의 div
                var sidebarResize = document.getElementById("sidebar");
                if ((screen.availHeight || screen.height - 30) <= window.innerHeight) {
                    mapResize.style.width = width_size - 320 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 147 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 147 - 4 + "px";
                    alert("전체화면은 지원하지 않습니다.")
                } else if (width_size == 1920) {
                    mapResize.style.width = width_size - 320 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 147 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 147 - 4 + "px";
                } else {
                    mapResize.style.width = width_size - 336 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 164 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 164 - 4 + "px";
                }
            } else if (map_count == 1) {
                var width_size = window.outerWidth;
                // 화면의 height값을 가져오기
                var height_size = window.outerHeight;
                var mapResize = document.getElementById('map_div');//map의 div
                var sidebarResize = document.getElementById("sidebar");
                if ((screen.availHeight || screen.height - 30) <= window.innerHeight) {
                    mapResize.style.width = width_size - 0 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 147 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 147 - 4 + "px";
                    alert("전체화면은 지원하지 않습니다.")
                } else if (width_size == 1920) {
                    mapResize.style.width = width_size - 0 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 147 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 147 - 4 + "px";
                } else {
                    mapResize.style.width = width_size - 16 + "px";//map의 height 변경
                    mapResize.style.height = height_size - 164 - 4 + "px";//map의 height 변경
                    sidebarResize.style.height = height_size - 164 - 4 + "px";
                }
            }
        });

        // 탭1에서 출발지나 도착지의 정보를 가져왔을때
        function tap1Setting(){
            var type = [[${type}]];
            if(type != "null"){
                if(type == "start"){
                    var lat = [[${lat}]];
                    var lng = [[${lng}]];
                    var name = [[${name}]];
                    //Marker 객체 생성.
                    s_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        position: new Tmapv2.LatLng(lat,lng), //Marker의 중심좌표 설정.
                        draggable: true,
                        map: map //Marker가 표시될 Map 설정.
                    });
                    s_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                    document.getElementById("searchKeyword").value = name;
                    map.setCenter(new Tmapv2.LatLng(lat,lng));
                    map.setZoom(14);
                }else if(type == "end"){
                    var lat = [[${lat}]];
                    var lng = [[${lng}]];
                    var name = [[${name}]];
                    //Marker 객체 생성.
                    e_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        position: new Tmapv2.LatLng(lat,lng), //Marker의 중심좌표 설정.
                        draggable: true,
                        map: map //Marker가 표시될 Map 설정.
                    });
                    e_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                    document.getElementById("searchKeyword2").value = name;
                    map.setCenter(new Tmapv2.LatLng(lat,lng));
                    map.setZoom(14);
                }
            }
        }

        function initTmap() {
            tapCheck("tap2");
            var request_lat;
            var request_lng;
            if (page_lat == 0 && page_lng == 0) {
                request_lat = 37.570028;
                request_lng = 126.989072;
            } else {
                request_lat = page_lat;
                request_lng = page_lng;
            }
            console.log(page_lat, page_lng);
            sidebarResize = document.getElementById("sidebar");
            var width_size = window.outerWidth;
            var height_size = window.outerHeight;
            if (width_size == 1920) {
                sidebarResize.style.height = height_size - 147 - 4 + "px";
                // 1. 지도 띄우기
                map = new Tmapv2.Map("map_div", {
                    center: new Tmapv2.LatLng(request_lat, request_lng),
                    width: width_size - 320 + "px",
                    height: height_size - 147 - 4 + "px",
                    zoom: [[${page_zoom}]],
                    zoomControl: true,
                    scrollwheel: true
                });
            } else {
                sidebarResize.style.height = height_size - 164 + "px";
                // 1. 지도 띄우기
                map = new Tmapv2.Map("map_div", {
                    center: new Tmapv2.LatLng(request_lat, request_lng),
                    width: width_size - 336 + "px",
                    height: height_size - 164 - 4 + "px",
                    zoom: [[${page_zoom}]],
                    zoomControl: true,
                    scrollwheel: true
                });
                map.addListener("click", onClick); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            }
            tap1Setting();
            $("#btn_select").click(
                function () {
                    var searchKeyword = $('#searchKeyword').val(); // 검색 키워드
                    $.ajax({
                        method: "GET", // 요청 방식
                        url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json&callback=result", // url 주소
                        async: false, // 동기설정
                        data: { // 요청 데이터 정보
                            "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb", // 발급받은 Appkey
                            "searchKeyword": searchKeyword, // 검색 키워드
                            "resCoordType": "EPSG3857", // 요청 좌표계
                            "reqCoordType": "WGS84GEO", // 응답 좌표계
                            "count": 5 // 가져올 갯수
                        },
                        success: function (response) {
                            // 출발지 도착지 세팅을 위한 위도경도 배열 초기화
                            latLonArr = [];

                            var resultpoisData = response.searchPoiInfo.pois.poi;

                            // 2. 기존 마커, 팝업 제거
                            if (searchMarkerArr.length > 0) {
                                for (var i in searchMarkerArr) {
                                    searchMarkerArr[i].setMap(null);
                                }
                                searchMarkerArr = [];
                            }

                            if (labelArr.length > 0) {
                                for (var i in labelArr) {
                                    labelArr[i].setMap(null);
                                }
                                labelArr = [];
                            }
                            var innerHtml = ""; // Search Reulsts 결과값 노출 위한 변수
                            //맵에 결과물 확인 하기 위한 LatLngBounds객체 생성
                            var positionBounds = new Tmapv2.LatLngBounds();

                            nameArr = [];
                            // 3. POI 마커 표시
                            for (var k in resultpoisData) {
                                // POI 마커 정보 저장
                                var noorLat = Number(resultpoisData[k].noorLat);
                                var noorLon = Number(resultpoisData[k].noorLon);
                                var name = resultpoisData[k].name;
                                // 좌표 객체 생성
                                var pointCng = new Tmapv2.Point(
                                    noorLon, noorLat);

                                // EPSG3857좌표계를 WGS84GEO좌표계로 변환
                                var projectionCng = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                    pointCng);

                                var lat = projectionCng._lat;
                                var lon = projectionCng._lng;

                                // 좌표 설정
                                var markerPosition = new Tmapv2.LatLng(
                                    lat, lon);

                                nameArr.push(name);
                                // 출발지 도착지를 지정할때 사용할 위도 경도를 모아놓은 배열 넣기
                                latLonArr.push(markerPosition);

                                // Marker 설정
                                search_marker = new Tmapv2.Marker(
                                    {
                                        position: markerPosition, // 마커가 표시될 좌표
                                        //icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
                                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_"
                                            + k
                                            + ".png", // 아이콘 등록
                                        iconSize: new Tmapv2.Size(
                                            24, 38), // 아이콘 크기 설정
                                        title: name, // 마커 타이틀
                                        map: map // 마커가 등록될 지도 객체
                                    });

                                // 결과창에 나타날 검색 결과 html
                                // 출발지 도착지 세팅할 수 있게 해주는 버튼 추가
                                innerHtml += "<li><div><img src='http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png' style='vertical-align:middle;'/><span>"
                                    + name
                                    + "</span>  <button type='button' class='startButton' name='sendBtn' onClick='startPing("
                                    + k
                                    + "), start( " + k + " );'>선택</button></div></li>";

                                // 마커들을 담을 배열에 마커 저장
                                searchMarkerArr.push(search_marker);
                                positionBounds.extend(markerPosition); // LatLngBounds의 객체 확장
                            }


                            $("#searchResult").html(innerHtml); //searchResult 결과값 노출
                            map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                            map.zoomOut();
                        },
                        error: function (request, status, error) {
                            console.log("code:"
                                + request.status + "\n"
                                + "message:"
                                + request.responseText
                                + "\n" + "error:" + error);
                        }
                    });
                });
            $("#btn_select2").click(
                function () {
                    var searchKeyword = $('#searchKeyword2').val(); // 검색 키워드
                    $.ajax({
                        method: "GET", // 요청 방식
                        url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json&callback=result", // url 주소
                        async: false, // 동기설정
                        data: { // 요청 데이터 정보
                            "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb", // 발급받은 Appkey
                            "searchKeyword": searchKeyword, // 검색 키워드
                            "resCoordType": "EPSG3857", // 요청 좌표계
                            "reqCoordType": "WGS84GEO", // 응답 좌표계
                            "count": 5 // 가져올 갯수
                        },
                        success: function (response) {
                            // 출발지 도착지 세팅을 위한 위도경도 배열 초기화
                            latLonArr = [];

                            var resultpoisData = response.searchPoiInfo.pois.poi;

                            // 2. 기존 마커, 팝업 제거
                            if (searchMarkerArr.length > 0) {
                                for (var i in searchMarkerArr) {
                                    searchMarkerArr[i].setMap(null);
                                }
                                searchMarkerArr = [];
                            }

                            if (labelArr.length > 0) {
                                for (var i in labelArr) {
                                    labelArr[i].setMap(null);
                                }
                                labelArr = [];
                            }
                            var innerHtml = ""; // Search Reulsts 결과값 노출 위한 변수
                            //맵에 결과물 확인 하기 위한 LatLngBounds객체 생성
                            var positionBounds = new Tmapv2.LatLngBounds();

                            nameArr = [];
                            // 3. POI 마커 표시
                            for (var k in resultpoisData) {
                                // POI 마커 정보 저장
                                var noorLat = Number(resultpoisData[k].noorLat);
                                var noorLon = Number(resultpoisData[k].noorLon);
                                var name = resultpoisData[k].name;
                                // 좌표 객체 생성
                                var pointCng = new Tmapv2.Point(
                                    noorLon, noorLat);

                                // EPSG3857좌표계를 WGS84GEO좌표계로 변환
                                var projectionCng = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                    pointCng);

                                var lat = projectionCng._lat;
                                var lon = projectionCng._lng;

                                // 좌표 설정
                                var markerPosition = new Tmapv2.LatLng(
                                    lat, lon);

                                nameArr.push(name);
                                // 출발지 도착지를 지정할때 사용할 위도 경도를 모아놓은 배열 넣기
                                latLonArr.push(markerPosition);

                                // Marker 설정
                                search_marker = new Tmapv2.Marker(
                                    {
                                        position: markerPosition, // 마커가 표시될 좌표
                                        //icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
                                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_"
                                            + k
                                            + ".png", // 아이콘 등록
                                        iconSize: new Tmapv2.Size(
                                            24, 38), // 아이콘 크기 설정
                                        title: name, // 마커 타이틀
                                        map: map // 마커가 등록될 지도 객체
                                    });

                                // 결과창에 나타날 검색 결과 html
                                // 출발지 도착지 세팅할 수 있게 해주는 버튼 추가
                                innerHtml += "<li><div><img src='http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png' style='vertical-align:middle;'/><span>"
                                    + name
                                    + "</span><button type='button' class='endButton' name='sendBtn' onClick='endPing("
                                    + k
                                    + "), end( " + k + " );'>선택</button></div></li>";

                                // 마커들을 담을 배열에 마커 저장
                                searchMarkerArr.push(search_marker);
                                positionBounds.extend(markerPosition); // LatLngBounds의 객체 확장
                            }


                            $("#searchResult2").html(innerHtml); //searchResult 결과값 노출
                            map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                            map.zoomOut();
                        },
                        error: function (request, status, error) {
                            console.log("code:"
                                + request.status + "\n"
                                + "message:"
                                + request.responseText
                                + "\n" + "error:" + error);
                        }
                    });
                });
        }

            function onClick(e) {
                // marker 객체의 포지션 상황을 판단하여 출발지인지 도착지인지 확인
                // 출발지 -> 도착지 순서로 상세조회에서 도착지 설정을 했을 때 출발지로 바로가게 만듬
                if (s_marker.getPosition() == null) {

                    var result = e.latLng;
                    var resultDiv = document.getElementById("result");
                    resultDiv.innerHTML = result;


                    lonlat = e.latLng;
                    //Marker 객체 생성.
                    s_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                        draggable: true,
                        map: map //Marker가 표시될 Map 설정.
                    });
                    // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
                    s_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                } else if (e_marker.getPosition() == null) {
                    var result = e.latLng;
                    var resultDiv = document.getElementById("result");
                    resultDiv.innerHTML = result;

                    lonlat = e.latLng;
                    //Marker 객체 생성.
                    e_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                        position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                        draggable: true,
                        map: map //Marker가 표시될 Map 설정.
                    });
                    // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
                    e_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                    // 지도 클릭으로 도착지 설정이 완료되면 출발지는 무조건 설정되어있기 때문에 바로 경로를 탐색시켜 줌
                    ontestfoot();
                }
                // 출발지 도착지가 모두 설정되어있을 상황에 한번 더 누르면 출발지 도착지가 모두 지워지고 출발지 설정
                else if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                    removeMarkers();
                    onClick(e);
                }
            }

            // 드래그를 놓았을 때 발생하는 함수 출발지 도착지 설정이 완료되어있을 때만 실행됨
            function ontestfoot() {
                if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                    onfoot();
                }
            }

            // 검색을 제외한 모든 마커를 지우는 함수
            function removeMarkers() {
                // map 에서 marker marker2 를 지움
                s_marker.setMap(null);
                e_marker.setMap(null);
                // 마커가 있는지 비교할때 사용할 position null 세팅을 위한 기본 객체 생성
                s_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: null, //Marker의 중심좌표 설정.
                    draggable: true,
                    map: null //Marker가 표시될 Map 설정.
                });
                e_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: null, //Marker의 중심좌표 설정.
                    draggable: true,
                    map: null //Marker가 표시될 Map 설정.
                });
                // 경로탐색 라인을 지움
                if (resultdrawArr.length > 0) {
                    for (var i in resultdrawArr) {
                        resultdrawArr[i]
                            .setMap(null);
                    }
                    resultdrawArr = [];

                }
                // 경로탐색시 나오는 포인트 객체를 지움
                if (p_markerArr.length > 0) {
                    for (var i = 0; i < p_markerArr.length; i++) {
                        p_markerArr[i].setMap(null);
                    }
                    p_markerArr = [];
                }
            }

            // 경로탐색을 위한 함수
            function onfoot() {
                // 경로 상세 내용을 표기하기 위해 만들어줄 div 태그를 지정
                const course = document.getElementById("course");
                // 경로 상세 내용을 초기화
                course.innerHTML = "";

                // 실행 시에 출발지 도착지가 설정되어있어야만 실행되며 안되어있으면 alert 창 실행
                if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                    // 시작시 포인트 마커가 남아있으면 모두 삭제후 실행
                    if (p_markerArr.length > 0) {
                        for (var i = 0; i < p_markerArr.length; i++) {
                            p_markerArr[i].setMap(null);
                        }
                        p_markerArr = [];
                    }

                    // 3. 경로탐색 API 사용요청
                    $.ajax({
                        method: "POST",
                        url: "https://apis.openapi.sk.com/tmap/routes/pedestrian?version=1&format=json&callback=result",
                        async: false,
                        data: {
                            "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb",
                            "startX": s_marker.getPosition().lng(),// 현제 지도의 출발지 도착지 마커의 위도 경도를 뽑아옴
                            "startY": s_marker.getPosition().lat(),
                            "endX": e_marker.getPosition().lng(),
                            "endY": e_marker.getPosition().lat(),
                            "reqCoordType": "WGS84GEO",
                            "resCoordType": "EPSG3857",
                            "startName": "출발지",
                            "endName": "도착지"
                        },
                        success: function (response) {
                            var resultData = response.features;

                            //결과 출력
                            var tDistance = "총 거리 : "
                                + ((resultData[0].properties.totalDistance) / 1000)
                                    .toFixed(1) + "km,";
                            var tTime = " 총 시간 : "
                                + ((resultData[0].properties.totalTime) / 60)
                                    .toFixed(0) + "분";

                            $("#result").text(tDistance + tTime);

                            //기존 그려진 라인 & 마커가 있다면 초기화
                            if (resultdrawArr.length > 0) {
                                for (var i in resultdrawArr) {
                                    resultdrawArr[i]
                                        .setMap(null);
                                }
                                resultdrawArr = [];

                            }

                            drawInfoArr = [];


                            for (var i in resultData) { //for문 [S]
                                var geometry = resultData[i].geometry;
                                var properties = resultData[i].properties;
                                var polyline_;


                                if (geometry.type == "LineString") {
                                    for (var j in geometry.coordinates) {
                                        // 경로들의 결과값(구간)들을 포인트 객체로 변환
                                        var latlng = new Tmapv2.Point(
                                            geometry.coordinates[j][0],
                                            geometry.coordinates[j][1]);
                                        // 포인트 객체를 받아 좌표값으로 변환
                                        var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                            latlng);
                                        // 포인트객체의 정보로 좌표값 변환 객체로 저장
                                        var convertChange = new Tmapv2.LatLng(
                                            convertPoint._lat,
                                            convertPoint._lng);
                                        // 배열에 담기
                                        drawInfoArr.push(convertChange);
                                    }
                                } else {
                                    var markerImg = "";
                                    var pType = "";
                                    var size;

                                    if (properties.pointType == "S") { //출발지 마커
                                        markerImg = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png";
                                        pType = "S";
                                        size = new Tmapv2.Size(24, 38);
                                    } else if (properties.pointType == "E") { //도착지 마커
                                        markerImg = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png";
                                        pType = "E";
                                        size = new Tmapv2.Size(24, 38);
                                    } else { //각 포인트 마커
                                        markerImg = "http://topopen.tmap.co.kr/imgs/point.png";
                                        pType = "P";
                                        size = new Tmapv2.Size(8, 8);
                                    }

                                    // 경로들의 결과값들을 포인트 객체로 변환
                                    var latlon = new Tmapv2.Point(
                                        geometry.coordinates[0],
                                        geometry.coordinates[1]);

                                    // 포인트 객체를 받아 좌표값으로 다시 변환
                                    var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                        latlon);

                                    var routeInfoObj = {
                                        markerImage: markerImg,
                                        lng: convertPoint._lng,
                                        lat: convertPoint._lat,
                                        pointType: pType
                                    };

                                    // Marker 추가
                                    marker_p = new Tmapv2.Marker(
                                        {
                                            position: new Tmapv2.LatLng(
                                                routeInfoObj.lat,
                                                routeInfoObj.lng),
                                            icon: routeInfoObj.markerImage,
                                            iconSize: size,
                                            map: map
                                        });
                                    // 포인트 객체 초기화를 위해 배열에 현제 포인트 정보를 추가
                                    p_markerArr.push(marker_p);
                                }
                                if (geometry.type != "LineString") {
                                    console.log(properties.description);
                                    course.innerHTML += properties.description + "<br />";
                                }
                            }
                            //for문 [E]
                            drawLine(drawInfoArr);
                        },
                        error: function (request, status, error) {
                            console.log("code:" + request.status + "\n"
                                + "message:" + request.responseText + "\n"
                                + "error:" + error);
                        }
                    });

                } else {
                    alert("핑을 다 찍어주세오.")
                }
            }

            function searchRemove(){
                if (searchMarkerArr.length > 0) {
                    for (var i in searchMarkerArr) {
                        searchMarkerArr[i].setMap(null);
                    }
                    searchMarkerArr = [];
                }

                if (labelArr.length > 0) {
                    for (var i in labelArr) {
                        labelArr[i].setMap(null);
                    }
                    labelArr = [];
                }
            }
            function startPing(id) {
            console.log(nameArr[id]);
                // 출발지가 이미 지정되어 있으면 출발지 마커를 지우고 시작
                if (s_marker.getPosition() != null) {
                    s_marker.setMap(null);
                    s_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        position: null, //Marker의 중심좌표 설정.
                        draggable: true,
                        map: null //Marker가 표시될 Map 설정.
                    });
                }
                // 이전에 저장한 위도경도의 값을 불러옴
                var result = latLonArr[id];
                var resultDiv = document.getElementById("result");
                resultDiv.innerHTML = result;


                lonlat = latLonArr[id];
                //Marker 객체 생성.
                s_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                s_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                ontestfoot();
            }

            function start(id){
                document.getElementById("searchKeyword").value = nameArr[id];
                $("#searchResult").html("");
                document.getElementById("start-interface").style.display = "none";
                searchRemove();
            }

            function endPing(id) {
                // 도착지가 이미 지정되어 있으면 도착지 마커를 지우고 시작
                if (e_marker.getPosition() != null) {
                    e_marker.setMap(null);
                    e_marker = new Tmapv2.Marker({
                        icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                        position: null, //Marker의 중심좌표 설정.
                        draggable: true,
                        map: null //Marker가 표시될 Map 설정.
                    });
                }
                var result = latLonArr[id];
                var resultDiv = document.getElementById("result");
                resultDiv.innerHTML = result;

                lonlat = latLonArr[id];
                //Marker 객체 생성.
                e_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                    position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                e_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                ontestfoot();
            }

            function end(id){
                document.getElementById("searchKeyword2").value = nameArr[id];
                $("#searchResult2").html("");
                document.getElementById("end-interface").style.display = "none";
                searchRemove()
            }

            function drawLine(arrPoint) {
                var polyline_;

                polyline_ = new Tmapv2.Polyline({
                    path: arrPoint,
                    strokeColor: "#DD0000",
                    strokeWeight: 6,
                    map: map
                });
                resultdrawArr.push(polyline_);
            }

            $(function (){
                $('#searchKeyword').focus(function (){
                    searchRemove()
                    $("#searchResult2").html("");
                    document.getElementById("end-interface").style.display = "none";
                    document.getElementById("start-interface").style.display = "block";
                });
                $('#searchKeyword2').focus(function (){
                    searchRemove()
                    $("#searchResult").html("");
                    document.getElementById("start-interface").style.display = "none";
                    document.getElementById("end-interface").style.display = "block";
                });
            });

    </script>
</head>
<style>
    body {
        -ms-overflow-style: none;
        padding: 0;
        margin: 0;
        /*overflow: hidden;*/
    }

    ::-webkit-scrollbar {
        display: none;
    }

    #map_div {
        float: right;
        width: 100%;
        box-sizing: border-box;
    }

    #sidebar {
        float: left;
        width: 320px;
        height: 818px;
        background-color: #c7dbd2;
        border: 2px solid black;
        border-top: none;
    }

    #traffic_information {
        background-color: white;
        border: 1px solid #20c997;
        overflow: scroll;
        -ms-overflow-style: none;
        margin: 3%;
        height: 97%;
        padding: 5%;
    }

    #traffic_information::-webkit-scrollbar {
        display: none;
    }

    #start-interface{
        display: none;
    }
    #end-interface{
        display: none;
    }
</style>
<body>
<th:block th:replace="/kmj/header :: header"></th:block>
</body>
<body onload="initTmap();">
<div id="sidebar">
    <div id="traffic_information">
        <div style="margin-left: 17px">
            <div> <!-- 상단부분 -->
                <input type="text" class="text_custom" id="searchKeyword" name="searchKeyword" value="서울시">
                <div id="start-interface">
                    <button id="btn_select">적용하기</button>
                    <ul id="searchResult" name="searchResult">
                        <li>검색결과</li>
                    </ul>
                </div>
            </div>
            <div style="margin-right: 30px">
                <i onclick="pointChange()" class="fa-solid fa-arrows-repeat"></i>
            </div>
            <div>
                <input type="search" class="text_custom" id="searchKeyword2" placeholder="도착지">
                <div id="end-interface">
                    <button id="btn_select2">적용하기</button>
                    <ul id="searchResult2" name="searchResult">
                        <li>검색결과</li>
                    </ul>
                </div>
            </div>
            <div>
                <button onClick="searchPOI()" style="width: 95%; height: 50px">길찾기</button>
            </div>
        </div>
        <hr>
        <div id="myplace_2"> <!-- 하단부분 -->
            <div style="float: right">
                <i onclick="goSettings()" class="fa-solid fa-gear fa-2x"></i>
            </div>
            <hr>
            <h3>마이플레이스</h3>
            <div>
                집<i class="fa-solid fa-house"></i><input type="text" value="루틴~">
            </div>
            <div>
                회사<i class="fa-solid fa-building"></i><input type="text" value="루틴~">
            </div>
            <hr>
            <h3>루틴</h3>
            <div>
                <input type="text" placeholder="출근길">
            </div>
            <div>
                <input type="text" placeholder="퇴근길">
            </div>
            <hr>
            <p id="result"></p>
            <hr>
            <div id="course"></div>
        </div>
    </div>
</div>
<div id="map_div">
</div>
</body>
</html>