<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>MinitMap</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <script
            src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=l7xx71377ca4d61b42018b3da0ede8c234fb"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.0/font/bootstrap-icons.css">-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <script type="text/javascript" th:inline="javascript">
        function mainIconOver() {
            document.getElementById("MainIcon").src = "/icon/M-Click.png";
        }

        function mainIconOut() {
            document.getElementById("MainIcon").src = "/icon/M-removebg-preview.png";
        }

        function changecss(theClass, element, value) {
            var cssRules;
            if (document.all) {
                cssRules = 'rules';
            } else if (document.getElementById) {
                cssRules = 'cssRules';
            }
            var added = false;
            for (var S = 0; S < document.styleSheets.length; S++) {
                for (var R = 0; R < document.styleSheets.length; R++) {
                    if (document.styleSheets[S][cssRules][R].selectorText == theClass) {
                        if (document.styleSheets[S][cssRules][R].style[element]) {
                            document.styleSheets[S][cssRules][R].style[element] = value;
                            added = true;
                            break;
                        }
                    }
                }
                if (!added) {
                    if (document.styleSheets[S].insertRule) {
                        document.styleSheets[S].insertRule(theClass + '{' + element + ': ' + value + '}', document.styleSheets[S][cssRules].length);
                    } else if (document.styleSheets[S].addRule) {
                        document.styleSheets[S].addRule(theClass, element + ': ' + value + ';');
                    }
                }
            }
        }

        var tapLock = false;
        var onTap = 1;
        var my_marker;
        var marker;
        var page_lat = [[${page_lat}]];
        var page_lng = [[${page_lng}]];
        var map;
        var searchMarkerArr = [];
        var p_markerArr = [];
        var drawInfoArr = [];
        var resultdrawArr = [];
        var labelArr = [];
        var latLonArr = [];
        var nameArr = [];
        var myPlacesList = [];
        var rutinsList = [];
        var lon, lat;
        var s_marker = new Tmapv2.Marker({
            icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
            position: null, //Marker의 중심좌표 설정.
            draggable: true,
            map: null //Marker가 표시될 Map 설정.
        });
        var e_marker = new Tmapv2.Marker({
            icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
            position: null, //Marker의 중심좌표 설정.
            draggable: true,
            map: null //Marker가 표시될 Map 설정.
        });
        // 화면 크기가 변경될때마다 함수 호출
        $(window).resize(function () {
            console.log("리사이즈 실행됨")
            getInboundTraffic();
            var width_size = window.outerWidth;
            // 화면의 height값을 가져오기
            var height_size = window.outerHeight;
            var mapResize = document.getElementById('map_div');//map의 div
            var sidebarResize = document.getElementById("sidebar");
            if ((screen.availHeight || screen.height - 30) <= window.innerHeight) {
                mapResize.style.height = height_size - 67 - 4 + "px";//map의 height 변경
                sidebarResize.style.height = height_size - 67 - 4 + "px";
                changecss('.sidebars', 'height', height_size - 67 - 4 + 'px');
                alert("전체화면은 지원하지 않습니다.")
            } else if (width_size == 1920) {
                mapResize.style.height = height_size - 67 - 4 + "px";//map의 height 변경
                sidebarResize.style.height = height_size - 67 - 4 + "px";
                changecss('.sidebars', 'height', height_size - 67 - 4 + 'px');
            } else {
                mapResize.style.height = height_size - 84 - 4 + "px";//map의 height 변경
                sidebarResize.style.height = height_size - 84 - 4 + "px";
                changecss('.sidebars', 'height', height_size - 84 - 4 + 'px');
            }
        });

        // 사이드바 관련
        function sidebarHide1() {
            const sidebarIcon = document.getElementById("side1HideIcon");
            var sidebar = document.getElementById("side1");
            if (sidebar.style.left == "-395%") {
                sidebar.style.animation = "seek 0.9s";
                sidebar.style.left = "100%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                }, 900);
            } else {
                sidebar.style.animation = "hide 0.9s";
                sidebar.style.left = "-395%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                }, 900)
            }
        }

        function sidebarHide2() {
            const sidebarIcon = document.getElementById("side2HideIcon");
            var sidebar = document.getElementById("side2");
            if (sidebar.style.left == "-395%") {
                sidebar.style.animation = "seek 0.9s";
                sidebar.style.left = "100%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                }, 900);
            } else {
                sidebar.style.animation = "hide 0.9s";
                sidebar.style.left = "-395%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                }, 900)
            }
        }

        function sidebarHide3() {
            const sidebarIcon = document.getElementById("side3HideIcon");
            var sidebar = document.getElementById("side3");
            if (sidebar.style.left == "-395%") {
                sidebar.style.animation = "seek 0.9s";
                sidebar.style.left = "100%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                }, 900);
            } else {
                sidebar.style.animation = "hide 0.9s";
                sidebar.style.left = "-395%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                }, 900)
            }
        }

        function sidebarHide4() {
            const sidebarIcon = document.getElementById("side4HideIcon");
            var sidebar = document.getElementById("side4");
            if (sidebar.style.left == "-395%") {
                sidebar.style.animation = "seek 0.9s";
                sidebar.style.left = "100%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                }, 900);
            } else {
                sidebar.style.animation = "hide 0.9s";
                sidebar.style.left = "-395%";
                setTimeout(function () {
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                }, 900)
            }
        }

        function tap1() {
            if (tapLock == false) {
                tapLock = true;
                const sidebarIcon = document.getElementById("side1HideIcon");
                var sidebar = document.getElementById("side1");
                var sidebar2 = document.getElementById("side" + onTap);
                if (onTap != 1) {
                    sidebar2.style.left = "-500%";
                    sidebar.style.left = "100%";
                    if (sidebar2.style.left != "-395%") {
                        sidebar2.style.animation = "hide 0.9s";
                    }
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                    sidebar.style.animation = "seek 0.9s";
                    setTimeout(function () {
                        sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                        onTap = 1;
                        tapLock = false;
                    }, 900);
                } else if (onTap == 1) {
                    sidebarHide1();
                    tapLock = false;
                }
                if (onTap == 2) {
                    map.removeListener("click", onClick);
                }
                if (onTap == 4) {
                    map.removeListener("click", onClickTap4);
                }
                //ㅅㅎ 신호등 찍은것만 지우는 메서드
                if (addTraffic.length > 0) {

                    for (var i = 0; i < addTraffic.length; i++) {
                        addTraffic[i].setMap(null);
                    }
                    addTraffic = [];
                }
            }
        }

        //ㅅㅎ 북마크 신호등 가져오기
        function bookMarkTraffic() {
            let bookMarkTraffic = document.getElementById("bookMarkTraffic")
            $.ajax({
                    url: "/bookMark/list",
                    type: "post",
                    dataType: "json",
                    success: function (response) { // 결과 성공 콜백함수
                        console.log("북마크 가져오기 실행")
                        console.log(response)




                    },
                    error:

                        function (request, status, error) { // 결과 에러 콜백함수
                            console.log(error)
                        }
                }
            )
        }

        // ㅅㅎ

        function tap2() {
            if (tapLock == false) {
                tapLock = true;
                map.addListener("click", onClick); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                const sidebarIcon = document.getElementById("side2HideIcon");
                var sidebar = document.getElementById("side2");
                var sidebar2 = document.getElementById("side" + onTap);
                if (onTap != 2) {
                    sidebar2.style.left = "-500%";
                    sidebar.style.left = "100%";
                    if (sidebar2.style.left != "-395%") {
                        sidebar2.style.animation = "hide 0.9s";
                    }
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                    sidebar.style.animation = "seek 0.9s";
                    setTimeout(function () {
                        sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                        onTap = 2;
                        tapLock = false;
                    }, 900);
                } else if (onTap == 2) {
                    sidebarHide2();
                    tapLock = false;
                }
                if (onTap == 4) {
                    map.removeListener("click", onClickTap4);
                }
                //ㅅㅎ 신호등 찍은것만 지우는 메서드
                if (addTraffic.length > 0) {

                    for (var i = 0; i < addTraffic.length; i++) {
                        addTraffic[i].setMap(null);
                    }
                    addTraffic = [];
                }
            }
        }

        function tap3() {
            if (tapLock == false) {
                tapLock = true;
                const sidebarIcon = document.getElementById("side3HideIcon");
                var sidebar = document.getElementById("side3");
                var sidebar2 = document.getElementById("side" + onTap);
                if (onTap != 3) {
                    sidebar2.style.left = "-500%";
                    sidebar.style.left = "100%";
                    if (sidebar2.style.left != "-395%") {
                        sidebar2.style.animation = "hide 0.9s";
                    }
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                    sidebar.style.animation = "seek 0.9s";
                    setTimeout(function () {
                        sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                        onTap = 3;
                        tapLock = false;
                    }, 900);
                } else if (onTap == 3) {
                    sidebarHide3();
                    tapLock = false;
                }
                if (onTap == 2) {
                    map.removeListener("click", onClick);
                }
                if (onTap == 4) {
                    map.removeListener("click", onClickTap4);
                }
                //ㅅㅎ 신호등 찍은것만 지우는 메서드
                if (addTraffic.length > 0) {

                    for (var i = 0; i < addTraffic.length; i++) {
                        addTraffic[i].setMap(null);
                    }
                    addTraffic = [];
                }
            }
        }

        function sleep(ms) {
            const wakeUpTime = Date.now() + ms;
            while (Date.now() < wakeUpTime) {
            }
        }

        function getInboundTraffic() {
            if (startCheck > 0) {
                stopPrint();
            }
            trafficArray = [];


            let mapinfo = map.getCenter();
            let lat = mapinfo._lat;
            let lng = mapinfo._lng;
            let center = lat + "," + lng
            console.log(lat)
            console.log(lng)
            console.log(center)
            console.log("함수실행 확인")
            $.ajax({
                    type: "post", // 타입 (get, post, put 등등)
                    url: "/myTraffic/inBoundTrafficAll", // 요청할 서버url
                    dataType: "json", // 데이터 타입 (html, xml, json, text 등등)
                    data: { // 보낼 데이터 (Object , String, Array)
                        "center": center,
                    },
                    async: false,
                    success: function (response) { // 결과 성공 콜백함수
                        let today = new Date();
                        let hours = today.getHours();
                        let minutes = today.getMinutes();
                        let seconds = today.getSeconds();
                        let time = hours * 10000 + minutes * 100 + seconds;
                        trafficArray = response;

                        printStart();
                        startCheck++;


                    },
                    error:

                        function (request, status, error) { // 결과 에러 콜백함수
                            console.log(error)
                        }
                }
            )


        }


        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------

        function onDragend(e) {
            getInboundTraffic();
        }


        let TrafficStatus = 1;
        let time1
        let time2
        let time3

        function toggleRedOrGreen() {
            if (left_px > 10) {
                TrafficStatus = 1;
                document.getElementById("timeCheck1").placeholder = "청색불로 바뀐 시간"
                document.getElementById("timeCheck1").style.border = "solid 3px green"
                document.getElementById("timeCheck2").placeholder = "적색불로 바뀐 시간"
                document.getElementById("timeCheck3").placeholder = "청색불로 바뀐 시간"

            } else {
                TrafficStatus = -1;
                document.getElementById("timeCheck1").placeholder = "적색불로 바뀐 시간"
                document.getElementById("timeCheck1").style.border = "solid 3px red"
                document.getElementById("timeCheck2").placeholder = "청색불로 바뀐 시간"
                document.getElementById("timeCheck3").placeholder = "적색불로 바뀐 시간"

            }
        }

        let timeCheckCounrt = 1;

        function timeCheck() {
            let today = new Date();
            let time = today.toTimeString().split(" ")[0];

            if (timeCheckCounrt == 1) {
                document.getElementById("timeCheck1").style.border = "solid 2px gray"
                document.getElementById("timeCheck1").value = time;
                time1 = today;
                $("#toggle").attr("disabled", true); //설정
                if (TrafficStatus == 1) {
                    document.getElementById("timeCheck2").style.border = "solid 3px red"

                } else {
                    document.getElementById("timeCheck2").style.border = "solid 3px green"

                }

            }
            if (timeCheckCounrt == 2) {
                document.getElementById("timeCheck2").value = time;
                document.getElementById("timeCheck2").style.border = "solid 2px gray"
                time2 = today;

                if (TrafficStatus == 1) {
                    document.getElementById("timeCheck3").style.border = "solid 3px red"
                } else {
                    document.getElementById("timeCheck3").style.border = "solid 3px green"
                }
            }
            if (timeCheckCounrt == 3) {
                document.getElementById("timeCheck3").value = time;
                time3 = today;
                document.getElementById("timeCheck3").style.border = "solid 2px gray"
                $("#timeCheckBtn").attr("disabled", true); //설정
                trafficTimeCal();
                setTimeStartAndEnd();
                document.getElementById("trafficName").focus();
            }
            TrafficStatus *= -1;
            timeCheckCounrt++;
        }

        function trafficTimeCal() {
            if (TrafficStatus == 1) {
                document.getElementById("greenOnTime").value = Math.round((time2 - time1) / 1000);
                document.getElementById("redOnTime").value = Math.round((time3 - time2) / 1000);
            } else if (TrafficStatus == -1) {
                document.getElementById("redOnTime").value = Math.round((time2 - time1) / 1000);
                document.getElementById("greenOnTime").value = Math.round((time3 - time2) / 1000);
            }
        }

        function setTimeStartAndEnd() {
            let date = new Date();

            date.setMinutes(date.getMinutes() - 30);
            let time = date.getHours() * 10000 + date.getMinutes() * 100 + date.getSeconds()
            document.getElementById("startTime").value = time

            let date2 = new Date();
            date2.setMinutes(date2.getMinutes() + 30);
            let time2 = date2.getHours() * 10000 + date2.getMinutes() * 100 + date2.getSeconds()
            document.getElementById("endTime").value = time2
        }


        let addTraffic = [];
        let addTrafficLat = 0;
        let addTrafficLon = 0;

        function checklatlon() {
            if (addTraffic == 0) {
                alert("신호를 등록할 위치를 클릭해주세요");
            } else if (addTrafficLon == 0) {
                alert("신호를 등록할 위치를 클릭해주세요");
            }
        }

        function onClickTap4(e) {
            if (addTraffic.length > 0) {

                for (var i = 0; i < addTraffic.length; i++) {
                    addTraffic[i].setMap(null);
                }
                addTraffic = [];
            }
            let str = e.latLng.toString();

            let [latlat, lnglng] = str.split(',');
            addTrafficLat = latlat;
            addTrafficLon = lnglng;

            marker_Traffic = new Tmapv2.Marker(
                {
                    position: e.latLng, // 마커가 표시될 좌표
                    icon: "/icon/Traffic-light.png", // 아이콘 등록
                    iconSize: new Tmapv2.Size(
                        36, 57), // 아이콘 크기 설정
                    title: "marker_Traffic1", // 마커 타이틀
                    label: "test1",
                    map: map // 마커가 등록될 지도 객체
                });
            addTraffic.push(marker_Traffic);
        }

        let trafficArray = [];
        let startCheck = 0;
        let trafficOnMapArray = [];


        stopPrint = function () {
            clearInterval(printTraffic);
        };

        printStart = function () {
            printTraffic = setInterval(function () {
                if (trafficOnMapArray.length > 0) {
                    for (var i in trafficOnMapArray) {
                        trafficOnMapArray[i].setMap(null);
                    }
                    trafficOnMapArray = [];
                }

                console.log("프린트 프린트")
                let today = new Date();
                let hours = today.getHours();
                let minutes = today.getMinutes();
                let seconds = today.getSeconds();
                let time = hours * 10000 + minutes * 100 + seconds;
                for (let i = 0; i < trafficArray.length; i++) {
                    // console.log(trafficArray[0][i])
                    if (trafficArray[i].trafficApplyStart < time && time < trafficArray[i].trafficApplyEnd) {
                        var leftTime = trafficArray[i].leftTime + "초";
                        if (trafficArray[i].startType == 1) {
                            var marker_Traffic = new Tmapv2.Marker(
                                {
                                    position: new Tmapv2.LatLng(trafficArray[i].trafficLat, trafficArray[i].trafficLon), //Marker의 중심좌표 설정.
                                    icon: "/icon/greenOn.png", // 아이콘 등록
                                    iconSize: new Tmapv2.Size(
                                        36, 57), // 아이콘 크기 설정
                                    label: "<div style='text-align: center;display: inline-block;background-color: white;padding: 3px;color: green;font-size: 15px;'><b>" + leftTime + "</b></div>",
                                    zIndex: 5,
                                    map: map // 마커가 등록될 지도 객체
                                });
                            marker_Traffic.addListener("click", function (evt) {
                                label(trafficArray[i])
                            });

                            trafficOnMapArray.push(marker_Traffic);
                            trafficArray[i].leftTime--;
                            if (trafficArray[i].leftTime <= 0) {
                                trafficArray[i].startType *= -1;
                                trafficArray[i].leftTime = trafficArray[i].redOn
                            }


                        } else {
                            marker_Traffic = new Tmapv2.Marker(
                                {
                                    position: new Tmapv2.LatLng(trafficArray[i].trafficLat, trafficArray[i].trafficLon), //Marker의 중심좌표 설정.
                                    icon: "/icon/redOn.png", // 아이콘 등록
                                    iconSize: new Tmapv2.Size(
                                        36, 57), // 아이콘 크기 설정
                                    label: "<div style='text-align: center;display: inline-block;background-color: white;color: red;padding: 3px;font-size: 15px;'><b>" + leftTime + "</b></div>",
                                    zIndex: 5,
                                    map: map // 마커가 등록될 지도 객체
                                });
                            marker_Traffic.addListener("click", function (evt) {
                                label(trafficArray[i])
                            });
                            trafficOnMapArray.push(marker_Traffic);
                            trafficArray[i].leftTime--;
                            if (trafficArray[i].leftTime <= 0) {
                                trafficArray[i].startType *= -1;
                                trafficArray[i].leftTime = trafficArray[i].greenOn;
                            }


                        }

                    } else {
                        var marker_Traffic = new Tmapv2.Marker(
                            {
                                position: new Tmapv2.LatLng(trafficArray[i].trafficLat, trafficArray[i].trafficLon), //Marker의 중심좌표 설정.
                                icon: "/icon/offTraffic.png", // 아이콘 등록
                                iconSize: new Tmapv2.Size(
                                    36, 57), // 아이콘 크기 설정
                                zIndex: 5,
                                map: map // 마커가 등록될 지도 객체
                            });
                        marker_Traffic.addListener("click", function (evt) {
                            label(trafficArray[i])
                        });

                        trafficOnMapArray.push(marker_Traffic);

                    }


                }


            }, 1000);
        };

        function TrafficSetting() {
            let date = new Date();
            let time = date.getHours() * 10000 + date.getMinutes() * 100 + date.getSeconds()
            let myTrafficName = document.getElementById("myTrafficName");
            let myTrafficLat = document.getElementById("myTrafficLat");
            let myTrafficLon = document.getElementById("myTrafficLon");
            let trafficApplyStart = document.getElementById("trafficApplyStart");
            let trafficApplyEnd = document.getElementById("trafficApplyEnd");
            let greenOn = document.getElementById("greenOn");
            let redOn = document.getElementById("redOn");
            let startType = document.getElementById("startType");
            let setStartTime = document.getElementById("setStartTime");
            myTrafficName.value = document.getElementById("trafficName").value;
            myTrafficLat.value = addTrafficLat;
            myTrafficLon.value = addTrafficLon;
            trafficApplyStart.value = document.getElementById("startTime").value;
            trafficApplyEnd.value = document.getElementById("endTime").value;
            greenOn.value = document.getElementById("greenOnTime").value;
            redOn.value = document.getElementById("redOnTime").value;
            if (TrafficStatus == 1) {
                startType.value = "RED";
            } else {
                startType.value = "GREEN";
            }
            setStartTime.value = time;
        }

        function bookMarkAdd(id, ck) {
            if ([[${session.loginId}]] == null) {
                alert("로그인이 필요한 기능입니다.")
            } else {
                $.ajax({
                        type: "post", // 타입 (get, post, put 등등)
                        url: "/bookMark/save", // 요청할 서버url
                        dataType: "json", // 데이터 타입 (html, xml, json, text 등등)
                        data: { // 보낼 데이터 (Object , String, Array)
                            "trafficId": id,
                            "ck": ck,
                        },
                        async: false,
                        success: function (response) { // 결과 성공 콜백함수

                        },
                        error:

                            function (request, status, error) { // 결과 에러 콜백함수
                                console.log(error)
                            }
                    }
                )
            }
        }


        let labelArray = [];

        function label(response) {
            console.log("라벨 호출")
            if (labelArray.length != 0) {
                labelOnClose();
                labelArray = [];
            }
// 마크
            let firstTime = (response.trafficApplyStart - response.trafficApplyStart % 10000) / 10000 + ":" + (response.trafficApplyStart % 10000 - response.trafficApplyStart % 100) / 100 + ":" + response.trafficApplyStart % 100;
            let secondTime = (response.trafficApplyEnd - response.trafficApplyEnd % 10000) / 10000 + ":" + (response.trafficApplyEnd % 10000 - response.trafficApplyEnd % 100) / 100 + ":" + response.trafficApplyEnd % 100;
            let setTime = (response.setStartTime - response.setStartTime % 10000) / 10000 + "시" + (response.setStartTime % 10000 - response.setStartTime % 100) / 100 + "분" + response.setStartTime % 100 + "초";

            let content = "<div class='m-pop' id='labelDiv'>";
            if (response.trafficId == null) {
                content += "<div class='tit' style=' font-size: 16px; font-weight: bold;position: absolute;top: 5px;left: 15px'><div><b style='font-size: 30px'>" + response.myTrafficName + "</b><span style='margin-left: 15px'><i class=\"fa-solid fa-pen fa-2x\" onclick='myTrafficNameChange("+ response.myTrafficId +")'></i></span></div>";
            } else {
                content += "<div class='tit' style=' font-size: 16px; font-weight: bold;position: absolute;top: 5px;left: 15px'><div><b style='font-size: 30px'>" + response.trafficName + "</b><span style='margin-left: 15px'><i class=\"fa-solid fa-pen fa-2x\" onclick='adminTrafficNameChange("+response.trafficId+")'></i></span></div>";
            }
            content +=
                "<button onclick='labelOnClose()' class='btn-close' style='position: absolute; top: 5px; right: 0px; display: block; width: 15px; height: 15px; background: red no-repeat center;'><b style='text-align: justify-all'>X</b></button>" +
                "<div class='info-box'>" +
                "<div><span style='font-size: 20px;'>적용시간</span><span style='margin-left: 15px'><i class='fa-solid fa-gear fa-1x' onclick='편집()'></i></span></div>" +
                "<span id='leftInfoBox' style='font-size: 12px;float: left;width: 170px;display: block'><p>" + firstTime + "~" + secondTime + "</p>" +
                "Info" +
                "<p> 기준시 : " + setTime + "</p>" +
                "<p> 청색 주기 : " + response.greenOn + "초</p>" +
                "<p> 적색 주기 : " + response.redOn + "초</p>";

            if (response.trafficId == null) {
                content += "<button onclick='bookMarkAdd(" + response.myTrafficId + "," + "0" + ")'>" + "북마크추가버튼" + "</button>";

            } else {
                content += "<button onclick='bookMarkAdd(" + response.trafficId + "," + "1" + ")'>" + "북마크추가버튼" + "</button>";

            }


            content += "</span>" +
                "<span id='rightInfoBox' style='font-size: 12px;display: block;float: right;width: 110px'>" +
                "등록자: <span target='_blank' class='link' style='color: #3D6DCC; font-size: 13px; margin-left: 10px;'>" + response.nickName + "</span>" +
                "</span>";
            if (response.boardId != null) {
                content += "<span id='rightInfoBox' style='font-size: 12px;display: block;float: right;width: 110px'>" +
                    "등록글: <a onclick='boardDetail(" + response.boardId + ")' target='_blank' class='link' style='color: #3D6DCC; font-size: 13px; margin-left: 10px;'>" + response.boardId + "번</a>" +
                    "</span>";
            }


            content +=
                "</div>" +
                "<div id='bottomInfoBox' style='position: absolute; bottom: -130px;left: 10px;width: 260px;height: 70px;text-align: center'>";

            if (response.trafficId == null) {
                if (response.boardId != null) {
                    content += "<span style='float: left'><br/><button onclick='boardReport("+response.boardId+")' style='float: left'>오류신고</button></span><span style='float: right'><button onclick='like(" + response.boardId + ")' style='float: right'>맞아용</button><br /><button onclick='dislike(" + response.boardId + ")' style='float: right'>안맞아용</button></span>";
                } else {
                    content += "<span style='float: left'><br/>";
                }
            } else {
                content += "<span style='float: left'><br/><button onclick='' style='float: left'>오류신고</button></span><span style='float: right'><button style='float: right'>맞아용</button><br /><button style='float: right'>안맞아용</button></span>";
            }

            content +=
                "</div>" +
                "</div>" +
                "</div>";
            //Popup 객체 생성.
            let infoWindow = new Tmapv2.InfoWindow({
                position: new Tmapv2.LatLng(response.trafficLat, response.trafficLon), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                border: '0px solid #FF0000', //Popup의 테두리 border 설정.
                type: 2, //Popup의 type 설정.
                zIndex: 11,
                offset: new Tmapv2.Point(-25, -5),
                background: false,
                map: map //Popup이 표시될 맵 객체
            });
            labelArray.push(infoWindow)


        }

        function labelOnClose() {
            labelArray[0].setVisible(false);
        }

        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------
        // ㅅㅎ 탭4에서 쓸 변수 및 함수들 ------------------------------------------------

        function tap4() {
            if (tapLock == false) {
                tapLock = true;
                removeMarkers();
                const sidebarIcon = document.getElementById("side4HideIcon");
                var sidebar = document.getElementById("side4");
                var sidebar2 = document.getElementById("side" + onTap);
                if (onTap != 4) {
                    map.addListener("click", onClickTap4); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                    sidebar2.style.left = "-500%";
                    sidebar.style.left = "100%";
                    if (sidebar2.style.left != "-395%") {
                        sidebar2.style.animation = "hide 0.9s";
                    }
                    sidebarIcon.className = "fa-solid fa-angle-right fa-2xl";
                    sidebar.style.animation = "seek 0.9s";
                    setTimeout(function () {
                        sidebarIcon.className = "fa-solid fa-angle-left fa-2xl";
                        onTap = 4;
                        tapLock = false;
                    }, 900);
                } else if (onTap == 4) {
                    sidebarHide4();
                    tapLock = false;
                }
                if (onTap == 2) {
                    map.removeListener("click", onClick);
                }
            }
        }

        function myTrafficNameChange(id){
            let name = prompt('뭐로변경할까요???', '');
            $.ajax({
                url: "/myTraffic/updateName",
                type: "get",
                data: {
                    "id": id,
                    "name": name
                },
                success: function () {
                    alert("변경되었습니다.")
                    labelOnClose();
                }
            })
        }

        function adminTrafficNameChange(id){
            let name = prompt('뭐로변경할까요???', '');
            $.ajax({
                url: "/myTraffic/adminMyTraffic",
                type: "get",
                data: {
                    "id": id,
                    "name": name
                },
                success: function () {
                    alert("변경되었습니다.")
                    labelOnClose();
                    getInboundTraffic();
                }
            })
        }
        function like(num) {
            let loginCheck = [[${session.loginId}]]
            if (loginCheck != null) {
                $.ajax({
                    url: "/board/indexLike?like=1&boardId=" + num,
                    type: "get"
                })
                alert("맞아요~")
            } else {
                loginForm();
            }
        }
        function boardReport(id) {
            var width = 553;
            var height = 400;

            var left = (window.screen.width / 2) - (width / 2);
            var top = (window.screen.height / 4);

            var windowStatus = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top + ', scrollbars=no, status=no, resizable=yes, titlebar=yes';

            window.open("/board/report/"+ id, "신고하기", windowStatus);
        }

        function dislike(num) {
            let loginCheck = [[${session.loginId}]]
            if (loginCheck != null) {
                $.ajax({
                    url: "/board/indexLike?like=2&boardId=" + num,
                    type: "get"
                })
                alert("안맞아요~");
            } else {
                loginForm();
            }
        }

        function userTap() {
            var userTap = document.getElementById("user");
            if (userTap.className != 'show') {
                userTap.classList.add('show');
            } else {
                userTap.classList.remove('show');
            }
        }

        $(document).mouseup(function (e) {
            var user = $("#user");
            var userIcon = $(".userIcon");
            if (user.has(e.target).length === 0 && userIcon.has(e.target).length === 0) {
                user.removeClass("show");
            }
        });
        //사이드바 관련 끝

        //로그인

        function logout() {
            location.href = "/member/logout";
        }

        const loginAdmin = () => {
            location.href = "/member/findAll";
        }

        const loginForm = () => {
            var width = 480;
            var height = 630;

            var left = (window.screen.width / 2) - (width / 2);
            var top = (window.screen.height / 4);

            var windowStatus = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top + ', scrollbars=no, status=no, resizable=yes, titlebar=yes';

            window.open("/member/loginForm", "로그인", windowStatus);

        }

        function save() {
            var width = 480;
            var height = 600;
            var left = (window.screen.width / 2) - (width / 2);
            var top = (window.screen.height / 4);
            var windowStatus = 'width=' + width + ', height=' + height + ', left=' + left + ', top=' + top + ', scrollbars=no, status=no, resizable=yes, titlebar=yes';
            window.open("/member/saveForm", "회원가입", windowStatus);
        }

        function myPage(id) {
            if (id == null) {
                alert("로그인이 필요합니다");
                location.href = "/1tapTest";
            } else {
                location.href = "/member/myPage/" + id;
            }
        }

        //로그인 끝

        //List출력 ajax

        function myPlaceList() {
            $.ajax({
                url: "/myPlace/list",
                type: "get",
                dataType: "json",
                success: function (result) {
                    myPlacesList = result;
                    let output = "<table style=\"display: inline\" id=\"mypTap\">";
                    for (let i in result) {
                        output += "<tr class='myPlaceTap' onclick='myPlaceClick(" + result[i].myPlaceId + "," + result[i].myPlaceLat + "," + result[i].myPlaceLon + "," + '"' + result[i].myPlaceName + '"' + ")'>";
                        output += "<td>" + "<p>" + result[i].myPlaceName + "</p>";
                        output += "</td>" + "</tr>";
                        output += "<tr style='margin-bottom: 5px;display: none;' id='myPlace" + result[i].myPlaceId + "'>";
                        output += "<td><input type='button' onclick='startMyPlace(" + result[i].myPlaceId + ");tap2();' value='출발지'></td>";
                        output += "<td><input type='button' onclick='endMyPlace(" + result[i].myPlaceId + ")tap2();' value='도착지'></td>";
                        output += "</tr>";
                    }
                    output += "</table>";
                    document.getElementById("myPlaceList").innerHTML = output
                    output = "<table style=\"display: inline\" id=\"mypTap2\">";
                    for (let i in result) {
                        output += "<tr class='myPlaceTap' onclick='myPlaceClick2(" + result[i].myPlaceId + "," + result[i].myPlaceLat + "," + result[i].myPlaceLon + "," + '"' + result[i].myPlaceName + '"' + ")'>";
                        output += "<td>" + "<p>" + result[i].myPlaceName + "</p>";
                        output += "</td>" + "</tr>";
                        output += "<tr style='margin-bottom: 5px;display: none;' id='myPlace2" + result[i].myPlaceId + "'>";
                        output += "<td><input type='button' onclick='startMyPlace(" + result[i].myPlaceId + ")' value='출발지'></td>";
                        output += "<td><input type='button' onclick='endMyPlace(" + result[i].myPlaceId + ")' value='도착지'></td>";
                        output += "</tr>";
                    }
                    output += "</table>";
                    document.getElementById("myPlaceList2").innerHTML = output
                }
            })
        }

        function rutinList() {
            $.ajax({
                url: "/rutin/list",
                type: "get",
                dataType: "json",
                success: function (result) {
                    rutinsList = result;
                    let output = "<table style='width: 100%' id='rutinTap'>";
                    for (let i in result) {
                        output += "<tr class='myPlaceTap'>";
                        output += "<div id='" + result[i].rutinId + "'>";
                        output += "<td onclick='rutinSearch(" + result[i].rutinId + ");tap2();'>";
                        output += result[i].rutinName;
                        output += "</td>" + "</tr>" + "</div>";
                    }
                    output += "</table>";
                    document.getElementById("rutinList").innerHTML = output;
                    output = "<table style='width: 100%' id='rutinTap2'>";
                    for (let i in result) {
                        output += "<tr class='myPlaceTap'>";
                        output += "<div id='" + result[i].rutinId + "'>";
                        output += "<td onclick='rutinSearch(" + result[i].rutinId + ")'>";
                        output += result[i].rutinName;
                        output += "</td>" + "</tr>" + "</div>";
                    }
                    output += "</table>";
                    document.getElementById("rutinList2").innerHTML = output;
                }
            })
        }

        //list출력 ajax끝

        // 지도 띄우기
        function initTmap() {
            var request_lat;
            var request_lng;
            if (page_lat == 0 && page_lng == 0) {
                request_lat = 37.570028;
                request_lng = 126.989072;
            } else {
                request_lat = page_lat;
                request_lng = page_lng;
            }
            var sidebarResize = document.getElementById("sidebar");
            var height_size = window.outerHeight;
            var width_size = window.outerWidth;
            if (width_size == 1920) {
                sidebarResize.style.height = height_size - 67 - 4 + "px";
                changecss('.sidebars', 'height', height_size - 67 - 4 + 'px');
                // 1. 지도 띄우기
                map = new Tmapv2.Map("map_div", {
                    center: new Tmapv2.LatLng(request_lat, request_lng),
                    width: "100%",
                    height: height_size - 67 - 3 + "px",
                    zoom: [[${page_zoom}]],
                    zoomControl: true,
                    zIndexMarker: 8,
                    scrollwheel: true
                });
            } else {
                sidebarResize.style.height = height_size - 84 - 4 + "px";
                changecss('.sidebars', 'height', height_size - 84 - 4 + 'px');
                // 1. 지도 띄우기
                map = new Tmapv2.Map("map_div", {
                    center: new Tmapv2.LatLng(request_lat, request_lng),
                    width: "100%",
                    height: height_size - 84 - 3 + "px",
                    zoom: [[${page_zoom}]],
                    zoomControl: true,
                    zIndexMarker: 8,
                    scrollwheel: true
                });
            }
            getInboundTraffic();
            map.addListener("dragend", onDragend); // 지도 드래그 끝났을 때, 이벤트 리스너 등록.

            bookMarkTraffic(); // 북마크 가져오기


        }

        // 1탭
        function searchButton() {
            var searchKeyword = $('#searchKeyword').val(); // 검색 키워드
            $.ajax({
                method: "GET", // 요청 방식
                url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json&callback=result", // url 주소
                async: false, // 동기설정
                data: { // 요청 데이터 정보
                    "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb", // 발급받은 Appkey
                    "searchKeyword": searchKeyword, // 검색 키워드
                    "resCoordType": "EPSG3857", // 요청 좌표계
                    "reqCoordType": "WGS84GEO", // 응답 좌표계
                    "centerLon": map.getCenter().lng(),
                    "centerLat": map.getCenter().lat(),
                    "count": 6 // 가져올 갯수
                },
                success: function (response) {
                    // 출발지 도착지 세팅을 위한 위도경도 배열 초기화
                    latLonArr = [];
                    nameArr = [];
                    var resultpoisData = response.searchPoiInfo.pois.poi;
                    // 2. 기존 마커, 팝업 제거
                    if (searchMarkerArr.length > 0) {
                        for (var i in searchMarkerArr) {
                            searchMarkerArr[i].setMap(null);
                        }
                        searchMarkerArr = [];
                    }
                    if (labelArr.length > 0) {
                        for (var i in labelArr) {
                            labelArr[i].setMap(null);
                        }
                        labelArr = [];
                    }
                    var innerHtml = ""; // Search Reulsts 결과값 노출 위한 변수
                    //맵에 결과물 확인 하기 위한 LatLngBounds객체 생성
                    var positionBounds = new Tmapv2.LatLngBounds();
                    // 3. POI 마커 표시
                    for (var k in resultpoisData) {
                        // POI 마커 정보 저장
                        var noorLat = Number(resultpoisData[k].noorLat);
                        var noorLon = Number(resultpoisData[k].noorLon);
                        var name = resultpoisData[k].name;
                        // 상세정보를 표시하기 위한 id 값인데 지금은 안씀
                        // POI 정보의 ID
                        // var id = resultpoisData[k].id;
                        // 좌표 객체 생성
                        var pointCng = new Tmapv2.Point(
                            noorLon, noorLat);
                        // EPSG3857좌표계를 WGS84GEO좌표계로 변환
                        var projectionCng = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                            pointCng);
                        var lat = projectionCng._lat;
                        var lon = projectionCng._lng;
                        // 좌표 설정
                        var markerPosition = new Tmapv2.LatLng(
                            lat, lon);
                        // 출발지 도착지를 지정할때 사용할 위도 경도를 모아놓은 배열 넣기
                        latLonArr.push(markerPosition);
                        nameArr.push(name);
                        // Marker 설정
                        search_marker = new Tmapv2.Marker(
                            {
                                position: markerPosition, // 마커가 표시될 좌표
                                //icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
                                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_"
                                    + k
                                    + ".png", // 아이콘 등록
                                iconSize: new Tmapv2.Size(
                                    24, 38), // 아이콘 크기 설정
                                title: name, // 마커 타이틀
                                map: map // 마커가 등록될 지도 객체
                            });
                        // 결과창에 나타날 검색 결과 html
                        // 출발지 도착지 세팅할 수 있게 해주는 버튼 추가
                        innerHtml += "<li><div><div class='search-name'><img id='searchIcon" + k + "' src='http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png' style='vertical-align:middle;'/><span onclick='searchHide(" + k + ")' title='" + name + "'>"
                            + name
                            + "</span></div><div id='searchHide" + k + "' style='display: none'> <button type='button' name='sendBtn' onClick='startPing("
                            + k
                            + ");tap2()'>출발지</button> <button type='button' name='sendBtn' onClick='endPing("
                            + k
                            + ");tap2();'>도착지</button><div th:if=" + [[${session.loginEmail}]] + "> <input type='button' name='sendBtn' onClick='myPlaceSave("
                            + k
                            + ");' value='저장'></div></div></div></li>";
                        // 마커들을 담을 배열에 마커 저장
                        searchMarkerArr.push(search_marker);
                        positionBounds.extend(markerPosition); // LatLngBounds의 객체 확장
                    }
                    $("#searchResult").html(innerHtml); //searchResult 결과값 노출
                    map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                    map.zoomOut();
                },
                error: function (request, status, error) {
                    console.log("code:"
                        + request.status + "\n"
                        + "message:"
                        + request.responseText
                        + "\n" + "error:" + error);
                }
            });
        }

        function searchHide(k) {
            var searchHide = document.getElementById("searchHide" + k);
            var searchIcon = document.getElementById("searchIcon" + k);
            for (var i = 0; i < searchMarkerArr.length; i++) {
                if (i != k) {
                    document.getElementById("searchHide" + i).style.display = "none";
                    document.getElementById("searchIcon" + i).src = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + i + ".png";
                    searchMarkerArr[i].setIcon("http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + i + ".png");
                }
            }
            if (searchHide.style.display == "none") {
                searchHide.style.display = "inline";
                searchIcon.src = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_" + k + ".png";
                searchMarkerArr[k].setIcon("http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_" + k + ".png");
            } else {
                searchHide.style.display = "none";
                searchIcon.src = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png";
                searchMarkerArr[k].setIcon("http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png");
            }
        }

        function markerRemove() {
            if (marker != null) {
                marker.setMap(null);
                marker = null;
            }
        }

        function clickPing(lat, lng, name) {
            markerRemove();

            marker = new Tmapv2.Marker({
                position: new Tmapv2.LatLng(lat, lng), //Marker의 중심좌표 설정.
                title: name, // 마커 타이틀
                map: map //Marker가 표시될 Map 설정.
            });

            map.setCenter(new Tmapv2.LatLng(lat, lng));
            map.setZoom(17);
        }

        var clickId = 0;

        function myPlaceClick(id, lat, lng, name) {
            var myPlaceButton = document.getElementById("myPlace" + id);
            var mypButton = $(".mypButton");
            if (myPlaceButton.style.display == "inline") {
                myPlaceButton.style.display = "none";
                clickId = 0;
                markerRemove();
            } else if (myPlaceButton.style.display == "none") {
                if (clickId == 0) {
                    myPlaceButton.style.display = "inline";
                    clickId = id;
                    clickPing(lat, lng, name);
                } else if (clickId != 0) {
                    document.getElementById("myPlace" + clickId).style.display = "none";
                    myPlaceButton.style.display = "inline";
                    clickId = id;
                    clickPing(lat, lng, name);
                }
            }
        }

        function boardDetail(id) {
            window.open("/board/detail?id=" + id);
        }

        function myPlaceSave(id) {
            var lat = latLonArr[id].lat();
            var lng = latLonArr[id].lng();
            var name = nameArr[id];
            console.log(lat + "," + lng + "," + name);

            $.ajax({
                url: "/myPlace/saveCheck",
                type: "get",
                dataType: "text",
                data: {
                    "lat": lat,
                    "lon": lng
                },
                success: function (result) {
                    if (result == "ok") {
                        let title = prompt('마이플레이스명을 입력해주세요', '');
                        $.ajax({
                            url: "/myPlace/save?myPlaceLat=" + lat + "&myPlaceLng=" + lng + "&myPlaceName=" + title,
                            type: "get",
                            success: function () {
                                alert("마이플레이스에 추가되었습니다.");
                                myPlaceList();
                                document.getElementById("searchResult").innerHTML = "검색결과";
                                markerRemove();
                                if (searchMarkerArr.length > 0) {
                                    for (var i in searchMarkerArr) {
                                        searchMarkerArr[i].setMap(null);
                                    }
                                    searchMarkerArr = [];
                                }
                            }
                        })
                    } else {
                        alert("이미 등록되어있는 장소입니다!");
                    }
                }
            })
        }


        function mypTapDown() {
            var mypTap = document.getElementById("mypTap");
            var mypIcon = document.getElementById("mypIcon");
            if (mypTap.style.display == "inline") {
                mypTap.style.display = "none";
                mypIcon.className = "fa-solid fa-angle-down fa-2x"
            } else if (mypTap.style.display == "none") {
                mypTap.style.display = "inline";
                mypIcon.className = "fa-solid fa-angle-up fa-2x"
            }
        }

        function rutinDown() {
            var rutinTap = document.getElementById("rutinTap");
            var rutinIcon = document.getElementById("rutinIcon");
            if (rutinTap.style.display != "none") {
                rutinTap.style.display = "none";
                rutinIcon.className = "fa-solid fa-angle-down fa-2x"
            } else if (rutinTap.style.display == "none") {
                rutinTap.style.display = "table";
                rutinIcon.className = "fa-solid fa-angle-up fa-2x"
            }
        }

        function myPing() {
            var myPingColor = document.getElementById("myPingColor");
            if (myPingColor.style.color == "red") {
                myPingColor.style.color = "green";
                if (navigator.geolocation) {
                    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
                    navigator.geolocation.getCurrentPosition(function (position) {

                        lat = position.coords.latitude; // 위도
                        lon = position.coords.longitude; // 경도
                        if (my_marker != null) {
                            my_marker.setMap(null);
                            my_marker = null;
                        }
                        my_marker = new Tmapv2.Marker({
                            position: new Tmapv2.LatLng(lat, lon), //Marker의 중심좌표 설정.
                            map: map, //Marker가 표시될 Map 설정..
                            icon: 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_g_m_h.png'
                        });
                        map.setCenter(new Tmapv2.LatLng(lat, lon));
                        map.setZoom(18);
                    });
                    playAlert = setInterval(function () {
                        if (navigator.geolocation) {
                            // GeoLocation을 이용해서 접속 위치를 얻어옵니다
                            navigator.geolocation.getCurrentPosition(function (position) {

                                lat = position.coords.latitude; // 위도
                                lon = position.coords.longitude; // 경도
                                if (my_marker != null) {
                                    my_marker.setMap(null);
                                    my_marker = null;
                                }
                                my_marker = new Tmapv2.Marker({
                                    position: new Tmapv2.LatLng(lat, lon), //Marker의 중심좌표 설정.
                                    map: map, //Marker가 표시될 Map 설정..
                                    icon: 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_g_m_h.png'
                                });
                            });
                        }
                        console.log("내위치 찍기")
                    }, 5000);
                }
            } else {
                myPingColor.style.color = "red";
                clearInterval(playAlert);
            }

        }

        // 탭1 끝

        // 탭2

        function searchButton1() {
            var searchKeyword1 = $('#searchKeyword1').val(); // 검색 키워드
            $.ajax({
                method: "GET", // 요청 방식
                url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json&callback=result", // url 주소
                async: false, // 동기설정
                data: { // 요청 데이터 정보
                    "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb", // 발급받은 Appkey
                    "searchKeyword": searchKeyword1, // 검색 키워드
                    "resCoordType": "EPSG3857", // 요청 좌표계
                    "reqCoordType": "WGS84GEO", // 응답 좌표계
                    "centerLon": map.getCenter().lng(),
                    "centerLat": map.getCenter().lat(),
                    "count": 5 // 가져올 갯수
                },
                success: function (response) {
                    // 출발지 도착지 세팅을 위한 위도경도 배열 초기화
                    latLonArr = [];

                    var resultpoisData = response.searchPoiInfo.pois.poi;

                    // 2. 기존 마커, 팝업 제거
                    if (searchMarkerArr.length > 0) {
                        for (var i in searchMarkerArr) {
                            searchMarkerArr[i].setMap(null);
                        }
                        searchMarkerArr = [];
                    }

                    if (labelArr.length > 0) {
                        for (var i in labelArr) {
                            labelArr[i].setMap(null);
                        }
                        labelArr = [];
                    }
                    var innerHtml = ""; // Search Reulsts 결과값 노출 위한 변수
                    //맵에 결과물 확인 하기 위한 LatLngBounds객체 생성
                    var positionBounds = new Tmapv2.LatLngBounds();

                    nameArr = [];
                    // 3. POI 마커 표시
                    for (var k in resultpoisData) {
                        // POI 마커 정보 저장
                        var noorLat = Number(resultpoisData[k].noorLat);
                        var noorLon = Number(resultpoisData[k].noorLon);
                        var name = resultpoisData[k].name;
                        // 좌표 객체 생성
                        var pointCng = new Tmapv2.Point(
                            noorLon, noorLat);

                        // EPSG3857좌표계를 WGS84GEO좌표계로 변환
                        var projectionCng = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                            pointCng);

                        var lat = projectionCng._lat;
                        var lon = projectionCng._lng;

                        // 좌표 설정
                        var markerPosition = new Tmapv2.LatLng(
                            lat, lon);

                        nameArr.push(name);
                        // 출발지 도착지를 지정할때 사용할 위도 경도를 모아놓은 배열 넣기
                        latLonArr.push(markerPosition);

                        // Marker 설정
                        search_marker = new Tmapv2.Marker(
                            {
                                position: markerPosition, // 마커가 표시될 좌표
                                //icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
                                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_"
                                    + k
                                    + ".png", // 아이콘 등록
                                iconSize: new Tmapv2.Size(
                                    24, 38), // 아이콘 크기 설정
                                title: name, // 마커 타이틀
                                map: map // 마커가 등록될 지도 객체
                            });

                        // 결과창에 나타날 검색 결과 html
                        // 출발지 도착지 세팅할 수 있게 해주는 버튼 추가
                        innerHtml += "<li><div class='search-name' onmouseover='searchMouseUp(" + k + ")' onmouseout='searchMouseDown(" + k + ")'><img id='searchIcon" + k + "' src='http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png' style='vertical-align:middle;'/><span onclick='startPing("
                            + k
                            + "), start( " + k + " );' title='" + name + "'>"
                            + name
                            + "</span></div></li>";

                        // 마커들을 담을 배열에 마커 저장
                        searchMarkerArr.push(search_marker);
                        positionBounds.extend(markerPosition); // LatLngBounds의 객체 확장
                    }


                    $("#searchResult1").html(innerHtml); //searchResult 결과값 노출
                    map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                    map.zoomOut();
                },
                error: function (request, status, error) {
                    console.log("code:"
                        + request.status + "\n"
                        + "message:"
                        + request.responseText
                        + "\n" + "error:" + error);
                }
            });
        }

        function searchButton2() {
            var searchKeyword2 = $('#searchKeyword2').val(); // 검색 키워드
            $.ajax({
                method: "GET", // 요청 방식
                url: "https://apis.openapi.sk.com/tmap/pois?version=1&format=json&callback=result", // url 주소
                async: false, // 동기설정
                data: { // 요청 데이터 정보
                    "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb", // 발급받은 Appkey
                    "searchKeyword": searchKeyword2, // 검색 키워드
                    "resCoordType": "EPSG3857", // 요청 좌표계
                    "reqCoordType": "WGS84GEO", // 응답 좌표계
                    "centerLon": map.getCenter().lng(),
                    "centerLat": map.getCenter().lat(),
                    "count": 5 // 가져올 갯수
                },
                success: function (response) {
                    // 출발지 도착지 세팅을 위한 위도경도 배열 초기화
                    latLonArr = [];
                    var resultpoisData = response.searchPoiInfo.pois.poi;
                    // 2. 기존 마커, 팝업 제거
                    if (searchMarkerArr.length > 0) {
                        for (var i in searchMarkerArr) {
                            searchMarkerArr[i].setMap(null);
                        }
                        searchMarkerArr = [];
                    }
                    if (labelArr.length > 0) {
                        for (var i in labelArr) {
                            labelArr[i].setMap(null);
                        }
                        labelArr = [];
                    }
                    var innerHtml = ""; // Search Reulsts 결과값 노출 위한 변수
                    //맵에 결과물 확인 하기 위한 LatLngBounds객체 생성
                    var positionBounds = new Tmapv2.LatLngBounds();
                    nameArr = [];
                    // 3. POI 마커 표시
                    for (var k in resultpoisData) {
                        // POI 마커 정보 저장
                        var noorLat = Number(resultpoisData[k].noorLat);
                        var noorLon = Number(resultpoisData[k].noorLon);
                        var name = resultpoisData[k].name;
                        // 좌표 객체 생성
                        var pointCng = new Tmapv2.Point(
                            noorLon, noorLat);
                        // EPSG3857좌표계를 WGS84GEO좌표계로 변환
                        var projectionCng = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                            pointCng);
                        var lat = projectionCng._lat;
                        var lon = projectionCng._lng;
                        // 좌표 설정
                        var markerPosition = new Tmapv2.LatLng(
                            lat, lon);
                        nameArr.push(name);
                        // 출발지 도착지를 지정할때 사용할 위도 경도를 모아놓은 배열 넣기
                        latLonArr.push(markerPosition);
                        // Marker 설정
                        search_marker = new Tmapv2.Marker(
                            {
                                position: markerPosition, // 마커가 표시될 좌표
                                //icon : "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_a.png",
                                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_"
                                    + k
                                    + ".png", // 아이콘 등록
                                iconSize: new Tmapv2.Size(
                                    24, 38), // 아이콘 크기 설정
                                title: name, // 마커 타이틀
                                map: map // 마커가 등록될 지도 객체
                            });
                        // 결과창에 나타날 검색 결과 html
                        // 출발지 도착지 세팅할 수 있게 해주는 버튼 추가
                        innerHtml += "<li><div class='search-name' onmouseover='searchMouseUp(" + k + ")' onmouseout='searchMouseDown(" + k + ")'><img id='searchIcon" + k + "' src='http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png' style='vertical-align:middle;'/><span onclick='endPing("
                            + k
                            + "), end( " + k + " );' title='" + name + "'>"
                            + name
                            + "</span></div></li>";
                        // 마커들을 담을 배열에 마커 저장
                        searchMarkerArr.push(search_marker);
                        positionBounds.extend(markerPosition); // LatLngBounds의 객체 확장
                    }
                    $("#searchResult2").html(innerHtml); //searchResult 결과값 노출
                    if (resultpoisData.length == 1) {
                        map.setZoom(17);
                    } else {
                        map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                        map.zoomOut();
                    }
                },
                error: function (request, status, error) {
                    console.log("code:"
                        + request.status + "\n"
                        + "message:"
                        + request.responseText
                        + "\n" + "error:" + error);
                }
            });
        }

        function searchMouseUp(k) {
            var searchIcon = document.getElementById("searchIcon" + k);
            searchIcon.src = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_" + k + ".png";
            searchMarkerArr[k].setIcon("http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_" + k + ".png");
        }

        function searchMouseDown(k) {
            var searchIcon = document.getElementById("searchIcon" + k);
            searchIcon.src = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png";
            searchMarkerArr[k].setIcon("http://tmapapi.sktelecom.com/upload/tmap/marker/pin_b_m_" + k + ".png");
        }

        function onClick(e) {
            // marker 객체의 포지션 상황을 판단하여 출발지인지 도착지인지 확인
            // 출발지 -> 도착지 순서로 상세조회에서 도착지 설정을 했을 때 출발지로 바로가게 만듬
            if (s_marker.getPosition() == null) {
                lonlat = e.latLng;
                //Marker 객체 생성.
                s_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
                s_marker.addListener("dragend", onStart); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                reverseGeo(s_marker.getPosition().lng(), s_marker.getPosition().lat(), "searchKeyword1");
                ontestfoot();
            } else if (e_marker.getPosition() == null) {
                lonlat = e.latLng;
                //Marker 객체 생성.
                e_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                    position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
                e_marker.addListener("dragend", onEnd); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
                // 지도 클릭으로 도착지 설정이 완료되면 출발지는 무조건 설정되어있기 때문에 바로 경로를 탐색시켜 줌
                reverseGeo(e_marker.getPosition().lng(), e_marker.getPosition().lat(), "searchKeyword2");
                ontestfoot();
            }
            // 출발지 도착지가 모두 설정되어있을 상황에 한번 더 누르면 출발지 도착지가 모두 지워지고 출발지 설정
            else if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                document.getElementById("result").innerHTML = "거리/시간";
                // document.getElementById("course").innerHTML = "길안내";
                removeMarkers();
                onClick(e);
            }
        }

        // 드래그를 놓았을 때 발생하는 함수 출발지 도착지 설정이 완료되어있을 때만 실행됨
        function ontestfoot() {
            if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                onfoot();
            }
        }


        function onStart() {
            reverseGeo(s_marker.getPosition().lng(), s_marker.getPosition().lat(), "searchKeyword1");
            if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                onfoot();
            }
        }

        function onEnd() {
            reverseGeo(e_marker.getPosition().lng(), e_marker.getPosition().lat(), "searchKeyword2");
            if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                onfoot();
            }
        }

        // 검색을 제외한 모든 마커를 지우는 함수
        function removeMarkers() {
            // map 에서 marker marker2 를 지움
            s_marker.setMap(null);
            e_marker.setMap(null);
            // 마커가 있는지 비교할때 사용할 position null 세팅을 위한 기본 객체 생성
            s_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: null, //Marker의 중심좌표 설정.
                draggable: true,
                map: null //Marker가 표시될 Map 설정.
            });
            e_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: null, //Marker의 중심좌표 설정.
                draggable: true,
                map: null //Marker가 표시될 Map 설정.
            });
            // 경로탐색 라인을 지움
            if (resultdrawArr.length > 0) {
                for (var i in resultdrawArr) {
                    resultdrawArr[i]
                        .setMap(null);
                }
                resultdrawArr = [];
                if (addTraffic.length > 0) {

                    for (var i = 0; i < addTraffic.length; i++) {
                        addTraffic[i].setMap(null);
                    }
                    addTraffic = [];
                }

                if (addTraffic.length > 0) {

                    for (var i = 0; i < addTraffic.length; i++) {
                        addTraffic[i].setMap(null);
                    }
                    addTraffic = [];
                }


            }
            // 경로탐색시 나오는 포인트 객체를 지움
            if (p_markerArr.length > 0) {
                for (var i = 0; i < p_markerArr.length; i++) {
                    p_markerArr[i].setMap(null);
                }
                p_markerArr = [];
            }
        }

        // 경로탐색을 위한 함수
        function onfoot() {

            // // 경로 상세 내용을 표기하기 위해 만들어줄 div 태그를 지정
            // const course = document.getElementById("course");
            // // 경로 상세 내용을 초기화
            // course.innerHTML = "";

            // 실행 시에 출발지 도착지가 설정되어있어야만 실행되며 안되어있으면 alert 창 실행
            if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                // 시작시 포인트 마커가 남아있으면 모두 삭제후 실행
                if (p_markerArr.length > 0) {
                    for (var i = 0; i < p_markerArr.length; i++) {
                        p_markerArr[i].setMap(null);
                    }
                    p_markerArr = [];
                }

                // 3. 경로탐색 API 사용요청
                $.ajax({
                    method: "POST",
                    url: "https://apis.openapi.sk.com/tmap/routes/pedestrian?version=1&format=json&callback=result",
                    async: false,
                    data: {
                        "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb",
                        "startX": s_marker.getPosition().lng(),// 현제 지도의 출발지 도착지 마커의 위도 경도를 뽑아옴
                        "startY": s_marker.getPosition().lat(),
                        "endX": e_marker.getPosition().lng(),
                        "endY": e_marker.getPosition().lat(),
                        "reqCoordType": "WGS84GEO",
                        "resCoordType": "EPSG3857",
                        "startName": "출발지",
                        "endName": "도착지"
                    },
                    success: function (response) {

                        var positionBounds = new Tmapv2.LatLngBounds();

                        var markerPosition = new Tmapv2.LatLng(
                            s_marker.getPosition().lat(), s_marker.getPosition().lng());
                        positionBounds.extend(markerPosition);
                        markerPosition = new Tmapv2.LatLng(
                            e_marker.getPosition().lat(), e_marker.getPosition().lng());
                        positionBounds.extend(markerPosition);

                        var resultData = response.features;

                        //결과 출력
                        var tDistance = "총 거리 : "
                            + ((resultData[0].properties.totalDistance) / 1000)
                                .toFixed(1) + "km,";
                        var tTime = " 총 시간 : "
                            + ((resultData[0].properties.totalTime) / 60)
                                .toFixed(0) + "분";

                        $("#result").text(tDistance + tTime);

                        //기존 그려진 라인 & 마커가 있다면 초기화
                        if (resultdrawArr.length > 0) {
                            for (var i in resultdrawArr) {
                                resultdrawArr[i]
                                    .setMap(null);
                            }
                            resultdrawArr = [];

                        }

                        drawInfoArr = [];


                        for (var i in resultData) { //for문 [S]
                            var geometry = resultData[i].geometry;
                            var properties = resultData[i].properties;
                            var polyline_;


                            if (geometry.type == "LineString") {
                                for (var j in geometry.coordinates) {
                                    // 경로들의 결과값(구간)들을 포인트 객체로 변환
                                    var latlng = new Tmapv2.Point(
                                        geometry.coordinates[j][0],
                                        geometry.coordinates[j][1]);
                                    // 포인트 객체를 받아 좌표값으로 변환
                                    var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                        latlng);
                                    // 포인트객체의 정보로 좌표값 변환 객체로 저장
                                    var convertChange = new Tmapv2.LatLng(
                                        convertPoint._lat,
                                        convertPoint._lng);
                                    // 배열에 담기
                                    drawInfoArr.push(convertChange);
                                }
                            } else {
                                var markerImg = "";
                                var pType = "";
                                var size;

                                if (properties.pointType == "S") { //출발지 마커
                                    markerImg = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png";
                                    pType = "S";
                                    size = new Tmapv2.Size(24, 38);
                                } else if (properties.pointType == "E") { //도착지 마커
                                    markerImg = "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png";
                                    pType = "E";
                                    size = new Tmapv2.Size(24, 38);
                                } else { //각 포인트 마커
                                    markerImg = "http://topopen.tmap.co.kr/imgs/point.png";
                                    pType = "P";
                                    size = new Tmapv2.Size(8, 8);
                                }

                                // 경로들의 결과값들을 포인트 객체로 변환
                                var latlon = new Tmapv2.Point(
                                    geometry.coordinates[0],
                                    geometry.coordinates[1]);

                                // 포인트 객체를 받아 좌표값으로 다시 변환
                                var convertPoint = new Tmapv2.Projection.convertEPSG3857ToWGS84GEO(
                                    latlon);

                                var routeInfoObj = {
                                    markerImage: markerImg,
                                    lng: convertPoint._lng,
                                    lat: convertPoint._lat,
                                    pointType: pType
                                };

                                // Marker 추가
                                marker_p = new Tmapv2.Marker(
                                    {
                                        position: new Tmapv2.LatLng(
                                            routeInfoObj.lat,
                                            routeInfoObj.lng),
                                        icon: routeInfoObj.markerImage,
                                        iconSize: size,
                                        map: map
                                    });
                                // 포인트 객체 초기화를 위해 배열에 현제 포인트 정보를 추가
                                p_markerArr.push(marker_p);
                            }
                            // if (geometry.type != "LineString") {
                            //     console.log(properties.description);
                            //     course.innerHTML += properties.description + "<br />";
                            // }
                        }
                        //for문 [E]
                        drawLine(drawInfoArr);
                        map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
                        map.zoomOut();
                    },
                    error: function (request, status, error) {
                        console.log("code:" + request.status + "\n"
                            + "message:" + request.responseText + "\n"
                            + "error:" + error);
                    }
                });

            } else {
                alert("핑을 다 찍어주세오.")
            }
        }

        function searchRemove() {
            if (searchMarkerArr.length > 0) {
                for (var i in searchMarkerArr) {
                    searchMarkerArr[i].setMap(null);
                }
                searchMarkerArr = [];
            }

            if (labelArr.length > 0) {
                for (var i in labelArr) {
                    labelArr[i].setMap(null);
                }
                labelArr = [];
            }
        }

        function startPing(id) {
            document.getElementById("searchKeyword1").value = nameArr[id];
            // 출발지가 이미 지정되어 있으면 출발지 마커를 지우고 시작
            if (s_marker.getPosition() != null) {
                document.getElementById("result").innerHTML = "거리/시간";
                // document.getElementById("course").innerHTML = "길안내";
                s_marker.setMap(null);
                s_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: null, //Marker의 중심좌표 설정.
                    draggable: true,
                    map: null //Marker가 표시될 Map 설정.
                });
            }
            lonlat = latLonArr[id];
            //Marker 객체 생성.
            s_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                draggable: true,
                map: map //Marker가 표시될 Map 설정.
            });
            s_marker.addListener("dragend", onStart); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            ontestfoot();
        }

        function start(id) {
            document.getElementById("searchKeyword1").value = nameArr[id];
            $("#searchResult1").html("");
            document.getElementById("start-interface").style.display = "none";
            searchRemove();
        }

        function endPing(id) {
            document.getElementById("searchKeyword2").value = nameArr[id];
            // 도착지가 이미 지정되어 있으면 도착지 마커를 지우고 시작
            if (e_marker.getPosition() != null) {
                document.getElementById("result").innerHTML = "거리/시간";
                // document.getElementById("course").innerHTML = "길안내";
                e_marker.setMap(null);
                e_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: null, //Marker의 중심좌표 설정.
                    draggable: true,
                    map: null //Marker가 표시될 Map 설정.
                });
            }
            lonlat = latLonArr[id];
            //Marker 객체 생성.
            e_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                position: new Tmapv2.LatLng(lonlat.lat(), lonlat.lng()), //Marker의 중심좌표 설정.
                draggable: true,
                map: map //Marker가 표시될 Map 설정.
            });
            e_marker.addListener("dragend", onEnd); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            ontestfoot();
        }

        function end(id) {
            document.getElementById("searchKeyword2").value = nameArr[id];
            $("#searchResult2").html("");
            document.getElementById("end-interface").style.display = "none";
            searchRemove()
        }

        function drawLine(arrPoint) {
            var polyline_;

            polyline_ = new Tmapv2.Polyline({
                path: arrPoint,
                strokeColor: "#DD0000",
                strokeWeight: 6,
                map: map
            });
            resultdrawArr.push(polyline_);
        }

        $(function () {
            $('#searchKeyword1').focus(function () {
                searchRemove()
                $("#searchResult2").html("<li>검색결과</li>");
                document.getElementById("end-interface").style.display = "none";
                document.getElementById("start-interface").style.display = "block";
            });
            $('#searchKeyword2').focus(function () {
                searchRemove()
                $("#searchResult1").html("<li>검색결과</li>");
                document.getElementById("start-interface").style.display = "none";
                document.getElementById("end-interface").style.display = "block";
            });
        });

        function pointChange() {
            var startname = document.getElementById("searchKeyword1").value;
            var endname = document.getElementById("searchKeyword2").value;
            document.getElementById("searchKeyword1").value = endname;
            document.getElementById("searchKeyword2").value = startname;
            var startLat = 0, startLng = 0, endLat = 0, endLng = 0;
            if (s_marker.getPosition() != null) {
                startLat = s_marker.getPosition().lat();
                startLng = s_marker.getPosition().lng();
            }
            if (e_marker.getPosition() != null) {
                endLat = e_marker.getPosition().lat();
                endLng = e_marker.getPosition().lng();
            }
            console.log("start: " + startLat + "," + startLng + "end: " + endLng + "," + endLat);
            removeMarkers();
            if (endLat != 0) {
                s_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                    position: new Tmapv2.LatLng(endLat, endLng), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                s_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            }
            if (startLat != 0) {
                e_marker = new Tmapv2.Marker({
                    icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                    position: new Tmapv2.LatLng(startLat, startLng), //Marker의 중심좌표 설정.
                    draggable: true,
                    map: map //Marker가 표시될 Map 설정.
                });
                e_marker.addListener("dragend", ontestfoot); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            }
            ontestfoot();
        }

        var clickId2 = 0;

        function myPlaceClick2(id, lat, lng, name) {
            var myPlaceButton = document.getElementById("myPlace2" + id);
            var mypButton = $(".mypButton");
            if (myPlaceButton.style.display == "inline") {
                myPlaceButton.style.display = "none";
                clickId2 = 0;
                markerRemove();
            } else if (myPlaceButton.style.display == "none") {
                if (clickId2 == 0) {
                    myPlaceButton.style.display = "inline";
                    clickId2 = id;
                    clickPing(lat, lng, name);
                } else if (clickId2 != 0) {
                    document.getElementById("myPlace2" + clickId2).style.display = "none";
                    myPlaceButton.style.display = "inline";
                    clickId2 = id;
                    clickPing(lat, lng, name);
                }
            }
        }

        function mypTapDown2() {
            var mypTap = document.getElementById("mypTap2");
            var mypIcon = document.getElementById("mypIcon2");
            if (mypTap.style.display == "inline") {
                mypTap.style.display = "none";
                mypIcon.className = "fa-solid fa-angle-down fa-2x"
            } else if (mypTap.style.display == "none") {
                mypTap.style.display = "inline";
                mypIcon.className = "fa-solid fa-angle-up fa-2x"
            }
        }

        function rutinSave() {
            if (e_marker.getPosition() != null && s_marker.getPosition() != null) {
                var memberId = [[${session.loginId}]];
                var startPoint = document.getElementById("searchKeyword1").value;
                var destination = document.getElementById("searchKeyword2").value;
                var startPointLat = s_marker.getPosition().lat();
                var startPointLon = s_marker.getPosition().lng();
                var endPointLat = e_marker.getPosition().lat();
                var endPointLon = e_marker.getPosition().lng();
                let rutinName = prompt('루틴명을 입력해주세요', '');
                $.ajax({
                    type: "post",
                    url: "/rutin/save",
                    data: {
                        "memberId": memberId,
                        "startPoint": startPoint,
                        "startPointLat": startPointLat,
                        "startPointLon": startPointLon,
                        "destination": destination,
                        "endPointLat": endPointLat,
                        "endPointLon": endPointLon,
                        "rutinName": rutinName
                    },
                    dataType: "text",
                    success: function (result) {
                        if (result == "yes") {
                            alert("내 루틴에 저장했습니다.");
                            rutinList();
                        } else {
                            alert("실패했습니다.");
                        }
                    },
                    error: function () {
                        alert("홈페이지 오류");
                    }
                });
            } else {
                alert("출발지와 도착지를 모두 설정해 주세요.")
            }
        }

        function startMyPlace(id) {
            var index = 0;
            for (var i = 0; i < myPlacesList.length; i++) {
                if (myPlacesList[i].myPlaceId == id) {
                    index = i;
                }
            }
            if (clickId != 0) {
                document.getElementById("myPlace" + clickId).style.display = "none";
            }
            if (clickId2 != 0) {
                document.getElementById("myPlace2" + clickId2).style.display = "none";
            }
            markerRemove();
            document.getElementById("searchKeyword1").value = myPlacesList[index].myPlaceName;
            if (s_marker.getPosition() != null) {
                s_marker.setMap(null);
                s_marker = null;
            }
            s_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: new Tmapv2.LatLng(myPlacesList[index].myPlaceLat, myPlacesList[index].myPlaceLon),
                draggable: true,
                map: map
            });
            s_marker.addListener("dragend", onStart);
            ontestfoot();
        }

        function endMyPlace(id) {
            var index = 0;
            for (var i = 0; i < myPlacesList.length; i++) {
                if (myPlacesList[i].myPlaceId == id) {
                    index = i;
                }
            }
            document.getElementById("myPlace" + clickId).style.display = "none";
            document.getElementById("myPlace2" + clickId).style.display = "none";
            markerRemove();
            document.getElementById("searchKeyword2").value = myPlacesList[index].myPlaceName;
            if (e_marker.getPosition() != null) {
                e_marker.setMap(null);
                e_marker = null;
            }
            e_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: new Tmapv2.LatLng(myPlacesList[index].myPlaceLat, myPlacesList[index].myPlaceLon),
                draggable: true,
                map: map
            });
            e_marker.addListener("dragend", onStart);
            ontestfoot();
        }

        function rutinSearch(id) {
            removeMarkers();
            var index = 0;
            for (var i = 0; i < rutinsList.length; i++) {
                if (rutinsList[i].rutinId == id) {
                    index = i;
                }
            }
            var positionBounds = new Tmapv2.LatLngBounds();
            console.log(index);
            //출발지 설정
            s_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png",
                position: new Tmapv2.LatLng(rutinsList[index].startPointLat, rutinsList[index].startPointLon), //Marker의 중심좌표 설정.
                draggable: true,
                map: map //Marker가 표시될 Map 설정.
            });
            // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
            s_marker.addListener("dragend", onStart); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            $("#searchKeyword1").val(rutinsList[index].startPoint);

            var markerPosition = new Tmapv2.LatLng(
                rutinsList[index].startPointLat, rutinsList[index].startPointLon);
            positionBounds.extend(markerPosition);

            // 도착지 설정
            e_marker = new Tmapv2.Marker({
                icon: "http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png",
                position: new Tmapv2.LatLng(rutinsList[index].endPointLat, rutinsList[index].endPointLon), //Marker의 중심좌표 설정.
                draggable: true,
                map: map //Marker가 표시될 Map 설정.
            });
            // 드래그를 놓았을 때 발생하는 경로탐색 함수를 실행시키는 이벤트 추가
            e_marker.addListener("dragend", onEnd); // 이벤트의 종류와 해당 이벤트 발생 시 실행할 함수를 리스너를 통해 등록합니다
            // 지도 클릭으로 도착지 설정이 완료되면 출발지는 무조건 설정되어있기 때문에 바로 경로를 탐색시켜 줌
            $("#searchKeyword2").val(rutinsList[index].destination);
            ontestfoot();

            markerPosition = new Tmapv2.LatLng(
                rutinsList[index].endPointLat, rutinsList[index].endPointLon);
            positionBounds.extend(markerPosition);

            map.panToBounds(positionBounds); // 확장된 bounds의 중심으로 이동시키기
            map.zoomOut();

        }

        function reverseGeo(lon, lat, textId) {
            $
                .ajax({
                    method: "GET",
                    url: "https://apis.openapi.sk.com/tmap/geo/reversegeocoding?version=1&format=json&callback=result",
                    async: false,
                    data: {
                        "appKey": "l7xx71377ca4d61b42018b3da0ede8c234fb",
                        "coordType": "WGS84GEO",
                        "addressType": "A10",
                        "lon": lon,
                        "lat": lat
                    },
                    success: function (response) {
                        // 3. json에서 주소 파싱
                        var arrResult = response.addressInfo;

                        //법정동 마지막 문자
                        var lastLegal = arrResult.legalDong
                            .charAt(arrResult.legalDong.length - 1);

                        // 새주소
                        newRoadAddr = arrResult.city_do + ' '
                            + arrResult.gu_gun + ' ';

                        if (arrResult.eup_myun == ''
                            && (lastLegal == "읍" || lastLegal == "면")) {//읍면
                            newRoadAddr += arrResult.legalDong;
                        } else {
                            newRoadAddr += arrResult.eup_myun;
                        }
                        newRoadAddr += ' ' + arrResult.roadName + ' '
                            + arrResult.buildingIndex;

                        // 새주소 법정동& 건물명 체크
                        if (arrResult.legalDong != ''
                            && (lastLegal != "읍" && lastLegal != "면")) {//법정동과 읍면이 같은 경우

                            if (arrResult.buildingName != '') {//빌딩명 존재하는 경우
                                newRoadAddr += (' (' + arrResult.legalDong
                                    + ', ' + arrResult.buildingName + ') ');
                            } else {
                                newRoadAddr += (' (' + arrResult.legalDong + ')');
                            }
                        } else if (arrResult.buildingName != '') {//빌딩명만 존재하는 경우
                            newRoadAddr += (' (' + arrResult.buildingName + ') ');
                        }

                        // 구주소
                        jibunAddr = arrResult.city_do + ' '
                            + arrResult.gu_gun + ' '
                            + arrResult.legalDong + ' ' + arrResult.ri
                            + ' ' + arrResult.bunji;
                        //구주소 빌딩명 존재
                        if (arrResult.buildingName != '') {//빌딩명만 존재하는 경우
                            jibunAddr += (' ' + arrResult.buildingName);
                        }

                        var resultDiv = document.getElementById(textId);
                        resultDiv.value = newRoadAddr;

                    },
                    error: function (request, status, error) {
                        console.log("code:" + request.status + "\n"
                            + "message:" + request.responseText + "\n"
                            + "error:" + error);
                    }
                });

        }

        function rutinDown2() {
            var rutinTap = document.getElementById("rutinTap2");
            var rutinIcon = document.getElementById("rutinIcon2");
            if (rutinTap.style.display != "none") {
                rutinTap.style.display = "none";
                rutinIcon.className = "fa-solid fa-angle-down fa-2x"
            } else if (rutinTap.style.display == "none") {
                rutinTap.style.display = "table";
                rutinIcon.className = "fa-solid fa-angle-up fa-2x"
            }
        }

        // 탭2 끝

        // 탭3
        function detail(id) {
            var detail1 = "/board/detail?id=" + id;
            window.open(detail1)
        }

        function boardList() {
            let type = document.getElementById("typeChoice").value;
            $.ajax({
                url: "/board/3tap",
                type: "get",
                dataType: "json",
                data: {
                    "type": type
                },
                success: function (result) {
                    let output = "";
                    for (let i in result) {
                        output += "<tr class='colored' onclick='detail(" + result[i].boardId + ")'>";
                        output += "<td>" + result[i].boardType + "</td>";
                        output += "<td style='width:100%;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;'>" + result[i].boardTitle + "</td>";
                        output += "<td>" + result[i].boardLike + "</td>";
                        output += "</tr>";
                    }
                    document.getElementById('boardList').innerHTML = output;
                }
            })
        }

        const goBoardPages = () => {
            window.open("/board");
        }
        // 탭3 끝
    </script>
    <style>
        body {
            -ms-overflow-style: none;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        ::-webkit-scrollbar {
            display: none;
        }

        #map_div {
            float: right;
            width: 100%;
            box-sizing: border-box;
        }

        .sidebars {
            top: 0;
            left: -500%;
            position: absolute;
            width: 320px;
            height: 818px;
            background-color: #e8e8e8;
            border: 2px solid black;
            border-left: none;
        }

        #side1 {
            z-index: 97;
            left: 100%;
        }

        #side2 {
            z-index: 96;
        }

        #side3 {
            z-index: 95;
        }

        #side4 {
            z-index: 94;
        }

        #sidebar {
            float: left;
            position: absolute;
            z-index: 100;
            width: 65px;
            height: 818px;
            background-color: #e8e8e8;
            border: 2px solid black;
        }

        #sidebarTool {
            float: left;
            position: absolute;
            z-index: 100;
            width: 65px;
            height: 818px;
        }

        .search-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #start-interface {
            display: none;
        }

        #end-interface {
            display: none;
        }

        .sideTap {
            width: 100%;
            height: 100%;
            z-index: 99;
            position: relative;
        }

        .traffic_information {
            background-color: white;
            border: 1px solid #20c997;
            overflow: scroll;
            -ms-overflow-style: none;
            margin: 3%;
            height: 97%;
            padding: 5%;
        }

        .traffic_information::-webkit-scrollbar {
            display: none;
        }

        .myPlaceTap {
            display: inline-block;
            width: 250px;
        }

        .myPlaceTap:hover {
            background-color: #f3e9e9 !important;
            color: #303f39 !important;
        }

        .sideHide {
            padding: 8px 5px;;
            border: solid black 2px;
            border-left: none;
            background-color: #e8e8e8;
            color: #000000;
            position: absolute;
            top: 50%;
            left: 99.9%;
        }


        @keyframes hide {
            0% {
                position: absolute;
                left: 100%;
            }
            100% {
                position: absolute;
                left: -395%;
            }
        }

        @keyframes seek {
            0% {
                position: absolute;
                left: -395%;
            }
            100% {
                position: absolute;
                left: 100%;
            }
        }

        #MainIcon {
            display: block;
            left: 0%;
            top: 0%;
            width: 60px;
            height: 60px;
        }

        .tap {
            text-align: center;
            list-style-type: none;
            display: block;
            margin: 0;
            padding: 0;
        }

        .tap-result {
            margin-top: 15px;
        }

        .tapes {
            color: black;
        }

        tr.colored:hover td {
            background-color: #f3e9e9 !important;
            color: #303f39 !important;
        }

        .bottomTap {
            text-align: center;
            position: absolute;
            display: block;
            width: 60px;
            top: 93%;
            margin: 0;
            padding: 0;
        }

        .bottomTap i:hover {
            color: #0d6efd;
        }

        #user {
            position: absolute;
            padding: 10px;
            width: 300px;
            height: 150px;
            display: none;
            text-align: center;
            border: solid black 1px;
            right: -520%;
            bottom: 0px;
            border-radius: 40px;
            background-color: rgba(245, 245, 245, 0.8);
            z-index: 1000000;
        }

        #user.show {
            display: block;
        }

        .userContainer {
            position: relative;
            background-color: white;
            border-radius: 35px;
            width: 280px;
            height: 130px;
        }

        .loginForm {
            position: absolute;
            text-align: center;
            width: 100%;
            top: 50px;
        }

        .logTap {
            display: inline-block;
        }

        .toggleSwitch {
            width: 3rem;
            margin: 1rem;
            height: 1.5rem;
            position: relative;
            border-radius: 2rem;
            background-color: #ffc6d0;
            box-shadow: 0 0 1rem 3px rgba(0 0 0 / 15%);
            cursor: pointer;
        }


        .toggleSwitch .toggleButton {
            width: 1.3rem;
            height: 1.3rem;
            position: absolute;
            top: 50%;
            left: .2rem;
            transform: translateY(-50%);
            border-radius: 50%;
            background: #f03d3d;
        }

        /* 체크박스가 체크되면 변경 이벤트 */
        #toggle:checked ~ .toggleSwitch {
            background: #cdffc9;
        }

        #toggle:checked ~ .toggleSwitch .toggleButton {
            left: calc(100% - 1.4rem);
            background: #10ad1a;
        }

        .toggleSwitch, .toggleButton {
            transition: all 0.2s ease-in;
        }

        /*마크2*/
        #labelDiv {
            z-index: 11;
            position: static;
            display: flex;
            font-size: 14px;
            /*box-shadow: 5px 5px 5px #00000040;*/
            outline: black solid 5px;
            border-radius: 10px;
            width: 300px;
            height: 400px;
            background-color: #FFFFFF;
            padding: 20px;
            /*margin: 5px;*/
        }
    </style>
</head>
<body onload="initTmap();myPlaceList();rutinList();boardList();">
<div id="sidebarTool">
    <div style="position: relative">
        <div id="sidebar">
            <nav style="float: top">
                <div>
                    <img id="MainIcon" onmouseover="mainIconOver()" onmouseout="mainIconOut()"
                         src="/icon/M-removebg-preview.png" onclick="location.href='/Main'">
                </div>
                <ul class="tap">
                    <li class="tap-result">
                        <a id="tap1" class="tapes" onclick="tap1()"><i
                                class="fa-solid fa-magnifying-glass fa-3x"></i></a>
                    </li>
                    <li class="tap-result">
                        <a id="tap2" class="tapes" onclick="tap2()"><i class="fa-solid fa-road fa-3x"></i></a>
                    </li>
                    <li class="tap-result">
                        <a id="tap3" class="tapes" onclick="tap3()"><i class="fa-solid fa-file-pen fa-3x"></i></a>
                    </li>
                    <li class="tap-result">
                        <a id="tap4" class="tapes" onclick="tap4()"><i class="fa-solid fa-traffic-light fa-3x"></i></a>
                    </li>
                </ul>
                <div class="bottomTap">
                    <div style="position: relative">
                        <div class="userIcon">
                            <i class="fa-solid fa-user-large fa-3x" onclick="userTap()"></i>
                        </div>
                        <div id="user">
                            <div class="userContainer">
                                <h2 style="color: #0d6efd;">회원관리</h2>
                                <div class="loginForm">
                                    <div th:if="${session.loginEmail}">
                                        <button th:onclick="logout()" type="button" class="btn success logTap">▶로그아웃
                                        </button>
                                        <button th:onclick="|myPage(${session.loginId})|" type="button"
                                                class="btn success logTap">▶회원 정보
                                        </button>
                                        <div th:if="${session.loginEmail.toString().equals('admin')}"
                                             style="display:inline-block;">
                                            <button th:onclick="loginAdmin()" type="button" class="btn success logTap">
                                                ▶관리자 페이지
                                            </button>
                                        </div>
                                    </div>
                                    <div th:unless="${session.loginEmail}">
                                        <button onclick="loginForm()" type="button" class="btn success logTap">▶로그인
                                        </button>
                                        <button onclick="save()" type="button" class="btn success logTap">▶회원가입</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <div id="side1" class="sidebars">
            <div id="side12" class="sideTap">
                <div id="side1Hide" class="sideHide">
                    <i id="side1HideIcon" class="fa-solid fa-angle-left fa-2xl" onclick="sidebarHide1()"></i>
                </div>
                <div class="traffic_information">
                    <div style="margin-top: 8px">
                        <div>
                            <input style="width: 100%" type="search" id="searchKeyword" placeholder="장소검색창"
                                   onkeyup="if(window.event.keyCode==13){searchButton()}" autocomplete="off">
                        </div>
                        <br/>
                        <div class="title"><strong>Search</strong> Results</div>
                        <div class="rst_wrap">
                            <div class="rst mCustomScrollbar">
                                <ul id="searchResult" name="searchResult">
                                    <li>검색결과</li>
                                </ul>
                            </div>
                        </div>
                        <hr>
                        <div th:if="${session.loginEmail}">
                            <div>
                                <b>마이플레이스</b>
                                <div style="float: right">
                                    <i onclick="mypTapDown()" id="mypIcon" class="fa-solid fa-angle-up fa-2x"></i>
                                </div>
                                <br>
                                <div id="myPlaceList">
                                </div>
                            </div>
                            <hr>
                            <div>
                                <b>루틴</b>
                                <div style="float: right">
                                    <i onclick="rutinDown()" id="rutinIcon" class="fa-solid fa-angle-up fa-2x"></i>
                                </div>
                                <br>
                                <div id="rutinList">
                                </div>
                            </div>
                            <hr>
                            <div>
                                <b>자주보는 신호등</b> <br>
                                <div id="bookMarkTraffic"></div>
                            </div>
                            <hr>
                            <div th:if="${session.loginEmail.toString().equals('admin')}">
                                <button th:onclick="loginAdmin()" type="button" class="btn success">▶관리자 전용</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="side2" class="sidebars">
            <div id="side22" class="sideTap">
                <div id="side2Hide" class="sideHide" onclick="sidebarHide2()">
                    <i id="side2HideIcon" class="fa-solid fa-angle-left fa-2xl"></i>
                </div>
                <div class="traffic_information">
                    <div style="margin-left: 17px;width: 240px;display: block;">
                        <div style="position: relative;"><span style="width: 180px;display: inline-block"> <!-- 상단부분 --><input
                                type="text" class="text_custom mt-2 mb-2"
                                onkeyup="if(window.event.keyCode==13){searchButton1()}" id="searchKeyword1"
                                name="searchKeyword" placeholder="출발지" autocomplete="off"><div id="start-interface"><ul
                                id="searchResult1" name="searchResult">
                            <li>검색결과</li>
                        </ul></div><input type="search" class="text_custom mb-2"
                                          onkeyup="if(window.event.keyCode==13){searchButton2()}" id="searchKeyword2"
                                          placeholder="도착지" autocomplete="off"><div id="end-interface"><ul
                                id="searchResult2" name="searchResult">
                            <li>검색결과</li>
                        </ul></div></span>
                            <span style="display: inline-block;width: 30px;right: 18px;position: absolute;top: 20%"><i
                                    onclick="pointChange()" class="fa-solid fa-arrow-rotate-left fa-3x"></i></span>
                        </div>
                        <div style="margin-top: 5px" th:if="${session.loginEmail}">
                            <button onclick="rutinSave()" style="width: 100%; height: 50px">내 루틴 저장</button>
                        </div>
                    </div>
                    <div id="myplace_2" th:if="${session.loginEmail}"> <!-- 하단부분 -->
                        <hr>
                        <div>
                            <b>마이플레이스</b>
                            <div style="float: right">
                                <i onclick="mypTapDown2()" id="mypIcon2" class="fa-solid fa-angle-up fa-2x"></i>
                            </div>
                            <br>
                            <div id="myPlaceList2">
                            </div>
                        </div>
                        <hr>
                        <div>
                            <b>루틴</b>
                            <div style="float: right">
                                <i onclick="rutinDown2()" id="rutinIcon2" class="fa-solid fa-angle-up fa-2x"></i>
                            </div>
                            <br>
                            <div id="rutinList2">
                            </div>
                        </div>
                    </div>
                    <hr>
                    <p id="result">거리/시간</p>
                    <hr>
                    <!--                    <div id="course">길안내</div>-->
                </div>
            </div>
        </div>
        <div id="side3" class="sidebars">
            <div id="side32" class="sideTap">
                <div id="side3Hide" class="sideHide" onclick="sidebarHide3()">
                    <i id="side3HideIcon" class="fa-solid fa-angle-left fa-2xl"></i>
                </div>
                <div id="boardSave" class="traffic_information" style="text-align: center">
                    <div class="container">
                        <h4 style="text-align: center">주간 인기글</h4>
                        <div><select name="" id="typeChoice" style="float:left" onchange="boardList()"
                                     class="btn btn-sm btn-outline-secondary dropdown-toggle">
                            <option value="전체">전체</option>
                            <option value="신호">신호</option>
                            <option value="자유">자유</option>
                            <option value="공지">공지</option>
                        </select>
                            <button style="float: right;" class="btn btn-sm btn-outline-secondary"
                                    onclick="goBoardPages()">더보기
                            </button>
                        </div>
                        <table class="table table-striped table-sm" style="table-layout:fixed">
                            <thead>
                            <tr>
                                <th>카테고리</th>
                                <th>글 제목</th>
                                <th>좋아요</th>
                            </tr>
                            <thead>
                            <tbody id="boardList">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="side4" class="sidebars">
            <div id="side42" class="sideTap">
                <div id="side4Hide" class="sideHide">
                    <i id="side4HideIcon" class="fa-solid fa-angle-left fa-2xl" onclick="sidebarHide4()"></i>
                </div>
                <div class="traffic_information" style="text-align: center">
                    <h3>신호등추가</h3>
                    <hr>
                    <div style="size: 15px"><b>현재 신호등 상태</b></div>
                    <div style="position: center;display: inline-flex;align-items: center;">
                        <div>적신호</div>
                        <div style="margin-top: 20px;">
                            <input type="checkbox" id="toggle" hidden onclick="toggleRedOrGreen()">
                            <label for="toggle" class="toggleSwitch">
                                <span class="toggleButton" id="toggleBtn"></span>
                            </label>
                            <p id="jshTest"/>

                        </div>
                        <div>녹신호</div>
                    </div>
                    <hr>
                    <div class="box">
                        <div>
                            <div>
                                <input type="text" id="timeCheck1" placeholder="청색불로 바뀐 시간"
                                       class="timeCheckInputBoxGreen"
                                       style="margin-bottom: 8px;border:0; background-color: whitesmoke; border-radius: 20px; text-align: center"
                                >
                            </div>
                            <div>
                                <input type="text" id="timeCheck2" placeholder="적색불로 바뀐 시간"
                                       class="timeCheckInputBox"
                                       style="margin-bottom: 8px;border:0; background-color: whitesmoke; border-radius: 20px; text-align: center">
                            </div>
                            <div>
                                <input type="text" id="timeCheck3" placeholder="청색불로 바뀐 시간"
                                       class="timeCheckInputBox"
                                       style="margin-bottom: 5px;border:0; background-color: whitesmoke; border-radius: 20px; text-align: center">
                            </div>
                        </div>
                    </div>
                    <div style="display: block">
                        <input type="button" value="시간 기록"
                               style="width: 190px; height: 95px;margin-top: 5px;position: center;"
                               class="btn btn-outline-success"
                               onclick="timeCheck();" id="timeCheckBtn">
                    </div>
                    <hr>
                    <div class="box">
                        <h3>신호등 정보</h3>
                        <br/>
                        <div>
                            <input type="text" class="trafficCount" id="trafficName" placeholder="신호등 이름 입력"
                                   style="margin-bottom: 8px;border-radius: 20px; border-color: black; text-align: center"
                                   onblur="TrafficSetting();TrafficSetting();checklatlon()">
                        </div>
                        <div>
                            <input type="text" id="greenOnTime" class="trafficCount" placeholder="녹색불 점화 시간"
                                   onblur="TrafficSetting()"
                                   style="outline-color: #10ad1a;margin-bottom: 8px; border:0; border-radius: 20px; background-color: lawngreen;text-align: center;">
                        </div>
                        <div>
                            <input type="text" id="redOnTime" class="trafficCount" placeholder="적색불 점화 시간"
                                   onblur="TrafficSetting()"
                                   style="outline-color: red; border:0; border-radius: 20px; background-color: #f03d3d; text-align: center;">
                        </div>
                    </div>
                    <hr>
                    <h4>적용 시간대</h4>
                    <input type="text" id="startTime" class="trafficCount" placeholder="00:00:00"
                           style="border:0; background-color: whitesmoke; border-radius: 20px;outline-color:darkgray;text-align: center">
                    <div style="text-align: center">
                        ||
                    </div>
                    <input type="text" id="endTime" class="trafficCount" placeholder="00:00:00"
                           style="border:0; background-color: whitesmoke; border-radius: 20px; outline-color:darkgray;text-align: center">
                    <hr>
                    <form action="/myTraffic/saveTraffic" method="post">
                        <input type="hidden" name="memberId" id="memberId" th:value="${session.loginId}">
                        <input type="hidden" name="myTrafficName" id="myTrafficName" value="asd">
                        <input type="hidden" name="myTrafficLat" id="myTrafficLat" value="asd">
                        <input type="hidden" name="myTrafficLon" id="myTrafficLon" value="asd">
                        <input type="hidden" name="trafficApplyStart" id="trafficApplyStart" value="asd">
                        <input type="hidden" name="trafficApplyEnd" id="trafficApplyEnd" value="asd">
                        <input type="hidden" name="startType" id="startType" value="asd">
                        <input type="hidden" name="greenOn" id="greenOn" value="asd">
                        <input type="hidden" name="redOn" id="redOn" value="asd">
                        <input type="hidden" name="setStartTime" id="setStartTime" value="asd">
                        <button type="submit" class="btn btn-outline-warning" style="width: 190px">저장</button>
                        <br/><br/>
                        <input type="button" onclick="valueReset()" class="btn btn-outline-primary" style="width: 190px"
                               value="초기화">

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="map_div"></div>
<span class="fa-stack fa-2x" onclick="myPing()" style="position:absolute;z-index: 50;top:50px;right:80px;">
        <i class="fa-solid fa-circle fa-stack-2x" style="color:white;"></i>
        <i class="fa-solid fa-location-dot fa-stack-1x" id="myPingColor" style="color:red;"></i>
    </span>
</body>
<script>
    function valueReset() {
        const a1 = document.getElementById("timeCheck1").value = null;
        const a2 = document.getElementById("timeCheck2").value = null;
        const a3 = document.getElementById("timeCheck3").value = null;
        const a4 = document.getElementById("trafficName").value = null;
        const a5 = document.getElementById("greenOnTime").value = null;
        const a6 = document.getElementById("redOnTime").value = null;
        const a7 = document.getElementById("startTime").value = null;
        const a8 = document.getElementById("endTime").value = null;
        $("#timeCheckBtn").attr("disabled", false); //설정
        timeCheckCounrt = 0;
    }
</script>
</html>
